# æ¬Šé‡ç­–ç•¥è¦–è¦ºåŒ–æŒ‡å—

**ç‰ˆæœ¬**: v1.0
**æœ€å¾Œæ›´æ–°**: 2025-10-23
**å°æ‡‰ç‰ˆæœ¬**: app_preprocessed.py v4.1

---

## ğŸ“‹ æ¦‚è¿°

### ä»€éº¼æ˜¯æ¬Šé‡ç­–ç•¥ï¼Ÿ

æ¬Šé‡ç­–ç•¥ï¼ˆWeight Strategiesï¼‰æ˜¯ç”¨æ–¼è™•ç†**é¡åˆ¥ä¸å¹³è¡¡å•é¡Œ**çš„æŠ€è¡“ã€‚åœ¨é è™•ç†éšæ®µï¼Œç³»çµ±æœƒé å…ˆè¨ˆç®— **11 ç¨®ä¸åŒçš„æ¬Šé‡ç­–ç•¥**ï¼Œå­˜å„²åœ¨ NPZ çš„ `metadata.weight_strategies` ä¸­ï¼Œä¾›è¨“ç·´æ™‚é¸æ“‡ä½¿ç”¨ã€‚

### ç‚ºä»€éº¼éœ€è¦æ¬Šé‡ç­–ç•¥ï¼Ÿ

åœ¨æ¨™ç±¤åˆ†å¸ƒä¸­ï¼Œç¶“å¸¸æœƒå‡ºç¾é¡åˆ¥ä¸å¹³è¡¡ï¼š

```
Down (-1):    30% (2,273 æ¨£æœ¬)
Neutral (0):  40% (11,395 æ¨£æœ¬)  â† æ•¸é‡æœ€å¤š
Up (1):       30% (2,288 æ¨£æœ¬)
```

å¦‚æœä¸ä½¿ç”¨æ¬Šé‡ç­–ç•¥ï¼Œæ¨¡å‹æœƒ**åå‘é æ¸¬ Neutral**ï¼ˆå› ç‚ºæ•¸é‡å¤šï¼Œé æ¸¬æ­£ç¢ºç‡é«˜ï¼‰ï¼Œå°è‡´ Down/Up é¡åˆ¥è¢«å¿½è¦–ã€‚

### æ¬Šé‡ç­–ç•¥çš„ä½œç”¨

é€šéçµ¦ä¸åŒé¡åˆ¥åˆ†é…ä¸åŒçš„æ¬Šé‡ï¼Œè¿«ä½¿æ¨¡å‹**å¹³ç­‰é—œæ³¨æ‰€æœ‰é¡åˆ¥**ï¼š

```
Neutral æ¬Šé‡ > 1.0  â†’  æ¨¡å‹æ›´é—œæ³¨é€™å€‹é¡åˆ¥
Neutral æ¬Šé‡ < 1.0  â†’  æ¨¡å‹æ¸›å°‘é—œæ³¨é€™å€‹é¡åˆ¥
Down/Up æ¬Šé‡ > 1.0  â†’  æå‡å°‘æ•¸é¡åˆ¥çš„é‡è¦æ€§
```

---

## ğŸ¯ Label Viewer ä¸­çš„æ¬Šé‡ç­–ç•¥è¦–è¦ºåŒ–

### å•Ÿç”¨æ–¹å¼

1. å•Ÿå‹• Label Viewer
2. è¼‰å…¥æ—¥æœŸç›®éŒ„
3. é¸æ“‡è‚¡ç¥¨
4. **å‹¾é¸ã€Œæ¬Šé‡ç­–ç•¥å°æ¯” (weight_strategies)ã€**

### é¡¯ç¤ºå…§å®¹

#### 1. æ¬Šé‡ç­–ç•¥å°æ¯”æŸ±ç‹€åœ–

**ç‰¹é»**:
- X è»¸ï¼šç­–ç•¥åç¨±ï¼ˆ11 ç¨®ï¼‰
- Y è»¸ï¼šæ¬Šé‡å€¼
- ä¸‰ç¨®é¡è‰²æŸ±ï¼š
  - ç´…è‰²ï¼šDown (-1) æ¬Šé‡
  - ç°è‰²ï¼šNeutral (0) æ¬Šé‡
  - ç¶ è‰²ï¼šUp (1) æ¬Šé‡

**äº’å‹•**:
- æ‡¸åœï¼šé¡¯ç¤ºç­–ç•¥åç¨±å’Œå…·é«”æ¬Šé‡å€¼
- åœ–ä¾‹é»æ“Šï¼šéš±è—/é¡¯ç¤ºç‰¹å®šé¡åˆ¥

**ç¤ºä¾‹**:
```
balanced:
  Down: 1.11, Neutral: 2.38, Up: 1.11

sqrt_balanced:
  Down: 1.05, Neutral: 1.54, Up: 1.05

uniform:
  Down: 1.00, Neutral: 1.00, Up: 1.00
```

#### 2. æ¬Šé‡ç­–ç•¥è©³ç´°è³‡è¨Šè¡¨æ ¼

**æ¬„ä½**:
- **ç­–ç•¥åç¨±**: ç­–ç•¥è­˜åˆ¥ç¢¼
- **é¡å‹**: class_weight æˆ– focal
- **Down**: Down é¡åˆ¥æ¬Šé‡ï¼ˆ3 ä½å°æ•¸ï¼‰
- **Neutral**: Neutral é¡åˆ¥æ¬Šé‡
- **Up**: Up é¡åˆ¥æ¬Šé‡
- **èªªæ˜**: ç­–ç•¥æè¿°ï¼ˆä¸­è‹±æ–‡ï¼‰

**ç¯„ä¾‹**:
| ç­–ç•¥åç¨± | é¡å‹ | Down | Neutral | Up | èªªæ˜ |
|---------|------|------|---------|----|----|
| balanced | class_weight | 1.110 | 2.380 | 1.110 | Standard balanced weights |
| sqrt_balanced | class_weight | 1.050 | 1.540 | 1.050 | Square root of balanced weights |
| effective_num_0999 | class_weight | 1.020 | 1.920 | 1.040 | Effective Number (beta=0.999) |
| uniform | class_weight | 1.000 | 1.000 | 1.000 | No weighting |
| focal_loss | focal | 1.000 | 1.000 | 1.000 | Use Focal Loss (gamma=2.0) |

---

## ğŸ“Š 11 ç¨®æ¬Šé‡ç­–ç•¥è©³è§£

æ ¹æ“š [PREPROCESSED_DATA_SPECIFICATION.md](../docs/PREPROCESSED_DATA_SPECIFICATION.md)ï¼š

### 1. balancedï¼ˆæ¨™æº–å¹³è¡¡æ¬Šé‡ï¼‰

**å…¬å¼**: `weight = total / (n_classes * count)`

**ç‰¹é»**:
- æœ€å¸¸ç”¨çš„æ¬Šé‡ç­–ç•¥
- ç›´æ¥åæ¯”æ–¼é¡åˆ¥æ•¸é‡
- æ¬Šé‡å·®ç•°è¼ƒå¤§

**é©ç”¨**:
- é¡åˆ¥ä¸å¹³è¡¡åš´é‡ï¼ˆæ¯”ä¾‹ > 2:1ï¼‰
- éœ€è¦å¼·åˆ¶æ¨¡å‹é—œæ³¨å°‘æ•¸é¡åˆ¥

**ç¤ºä¾‹**:
```
å‡è¨­: Down 2273, Neutral 11395, Up 2288, Total 15956
Down weight = 15956 / (3 * 2273) = 2.34
Neutral weight = 15956 / (3 * 11395) = 0.47
Up weight = 15956 / (3 * 2288) = 2.33
```

---

### 2. sqrt_balancedï¼ˆå¹³æ–¹æ ¹å¹³è¡¡æ¬Šé‡ï¼‰

**å…¬å¼**: `weight = sqrt(balanced_weight)`

**ç‰¹é»**:
- æ¯” balanced æº«å’Œ
- æ¬Šé‡å·®ç•°è¼ƒå°
- æ›´ç©©å®šçš„è¨“ç·´

**é©ç”¨**:
- é¡åˆ¥ä¸å¹³è¡¡ä¸­ç­‰ï¼ˆæ¯”ä¾‹ 1.5:1 ~ 2:1ï¼‰
- éœ€è¦å¹³æ»‘çš„æ¬Šé‡èª¿æ•´

**å„ªé»**:
- âœ… è¨“ç·´æ›´ç©©å®š
- âœ… é¿å…éåº¦é—œæ³¨å°‘æ•¸é¡åˆ¥
- âœ… æ”¶æ–‚é€Ÿåº¦å¿«

---

### 3. log_balancedï¼ˆå°æ•¸å¹³è¡¡æ¬Šé‡ï¼‰

**å…¬å¼**: `weight = log(balanced_weight + 1) + 1`

**ç‰¹é»**:
- æœ€æº«å’Œçš„ç­–ç•¥
- æ¬Šé‡å·®ç•°æœ€å°
- é©åˆå¾®èª¿éšæ®µ

**é©ç”¨**:
- é¡åˆ¥ä¸å¹³è¡¡è¼•å¾®ï¼ˆæ¯”ä¾‹ < 1.5:1ï¼‰
- æ¨¡å‹å·²ç¶“è¨“ç·´è¼ƒå¥½ï¼Œéœ€è¦å¾®èª¿

---

### 4-7. effective_num_XXï¼ˆæœ‰æ•ˆæ¨£æœ¬æ•¸æ–¹æ³•ï¼‰

**ç­–ç•¥è®Šé«”**:
- effective_num_09 (beta=0.9)
- effective_num_099 (beta=0.99)
- effective_num_0999 (beta=0.999) â­ æ¨è–¦
- effective_num_09999 (beta=0.9999)

**å…¬å¼**: `weight = (1 - beta) / (1 - beta^count)`

**ç‰¹é»**:
- åŸºæ–¼ CVPR 2019 è«–æ–‡
- è€ƒæ…®æ¨£æœ¬ç´¯ç©æ•ˆæ‡‰
- beta è¶Šå¤§ï¼Œæ¬Šé‡èª¿æ•´è¶Šæ¿€é€²

**é©ç”¨**:
- éœ€è¦æ›´ç†è«–åŒ–çš„æ¬Šé‡è¨ˆç®—
- beta=0.999 æœ€å¸¸ç”¨ï¼ˆæ¨è–¦ï¼‰

**beta é¸æ“‡æŒ‡å—**:
- beta=0.9: æº«å’Œèª¿æ•´ï¼ˆé¡ä¼¼ sqrt_balancedï¼‰
- beta=0.99: ä¸­ç­‰èª¿æ•´
- beta=0.999: å¼·èª¿èª¿æ•´ï¼ˆæ¨è–¦ï¼‰ â­
- beta=0.9999: æ¿€é€²èª¿æ•´ï¼ˆé¡ä¼¼ balancedï¼‰

---

### 8-9. cb_focal_XXï¼ˆClass-Balanced Focal Lossï¼‰

**ç­–ç•¥è®Šé«”**:
- cb_focal_099 (beta=0.99)
- cb_focal_0999 (beta=0.999) â­ æ¨è–¦

**å…¬å¼**: çµåˆ Effective Number å’Œ Focal Loss

**ç‰¹é»**:
- åŒæ™‚è™•ç†é¡åˆ¥ä¸å¹³è¡¡å’Œé›£åˆ†æ¨£æœ¬
- éœ€é…åˆ Focal Loss ä½¿ç”¨
- æ¬Šé‡ + Loss é›™é‡èª¿æ•´

**é©ç”¨**:
- é¡åˆ¥ä¸å¹³è¡¡ + é›£åˆ†æ¨£æœ¬å¤š
- éœ€è¦æœ€å¼·çš„èª¿æ•´èƒ½åŠ›

---

### 10. uniformï¼ˆç„¡æ¬Šé‡ï¼‰

**å…¬å¼**: `weight = 1.0`

**ç‰¹é»**:
- æ‰€æœ‰é¡åˆ¥æ¬Šé‡ç›¸åŒ
- ä¸é€²è¡Œä»»ä½•èª¿æ•´
- åŸºæº–ç­–ç•¥

**é©ç”¨**:
- é¡åˆ¥å®Œå…¨å¹³è¡¡
- ä½œç‚ºå°æ¯”åŸºæº–

---

### 11. focal_lossï¼ˆFocal Lossï¼‰

**é¡å‹**: focalï¼ˆé class_weightï¼‰

**å…¬å¼**: `FL(p) = -Î±(1-p)^Î³ * log(p)`

**ç‰¹é»**:
- ä¸æ˜¯æ¬Šé‡ç­–ç•¥ï¼Œæ˜¯ Loss å‡½æ•¸
- gamma=2.0ï¼ˆæ¨™æº–è¨­ç½®ï¼‰
- éœ€åœ¨è¨“ç·´æ™‚æ›¿æ› Loss

**é©ç”¨**:
- é›£åˆ†æ¨£æœ¬å¤šï¼ˆæ¨¡å‹å°æŸäº›æ¨£æœ¬ä¿¡å¿ƒä¸è¶³ï¼‰
- é…åˆ class_weight ä½¿ç”¨æ•ˆæœæ›´ä½³

---

## ğŸ¯ å¦‚ä½•é¸æ“‡æ¬Šé‡ç­–ç•¥ï¼Ÿ

### å¿«é€Ÿæ±ºç­–æ¨¹

```
START
  â”‚
  â”œâ”€ é¡åˆ¥å®Œå…¨å¹³è¡¡ï¼ˆ30/30/30ï¼‰ï¼Ÿ
  â”‚   â””â”€ YES â†’ uniform
  â”‚
  â”œâ”€ é¡åˆ¥ä¸å¹³è¡¡åš´é‡ï¼ˆ> 2:1ï¼‰ï¼Ÿ
  â”‚   â””â”€ YES â†’ balanced æˆ– effective_num_0999 â­
  â”‚
  â”œâ”€ é¡åˆ¥ä¸å¹³è¡¡ä¸­ç­‰ï¼ˆ1.5:1 ~ 2:1ï¼‰ï¼Ÿ
  â”‚   â””â”€ YES â†’ sqrt_balanced æˆ– effective_num_099 â­
  â”‚
  â”œâ”€ æœ‰é›£åˆ†æ¨£æœ¬ï¼Ÿ
  â”‚   â””â”€ YES â†’ cb_focal_0999 + Focal Loss â­
  â”‚
  â””â”€ éœ€è¦å¾®èª¿ï¼Ÿ
      â””â”€ YES â†’ log_balanced
```

### æ¨è–¦çµ„åˆ

#### æƒ…æ³ 1: æ¨™æº–å ´æ™¯ï¼ˆæœ€å¸¸è¦‹ï¼‰

**æ¨™ç±¤åˆ†å¸ƒ**: Down 30%, Neutral 40%, Up 30%

**æ¨è–¦ç­–ç•¥**: `effective_num_0999` â­â­â­

**åŸå› **:
- ç†è«–åŸºç¤å¼·ï¼ˆCVPR 2019ï¼‰
- æ¬Šé‡èª¿æ•´é©ä¸­
- å»£æ³›é©—è­‰æœ‰æ•ˆ

**è¨“ç·´ä»£ç¢¼**:
```python
# å¾ NPZ è¼‰å…¥æ¬Šé‡
weight_strategies = metadata['weight_strategies']
strategy = weight_strategies['effective_num_0999']
class_weights = strategy['class_weights']

# è½‰æ›ç‚º PyTorch Tensor
import torch
weight_tensor = torch.FloatTensor([
    class_weights['-1'],  # Down
    class_weights['0'],   # Neutral
    class_weights['1']    # Up
])

# ä½¿ç”¨æ¬Šé‡
criterion = nn.CrossEntropyLoss(weight=weight_tensor)
```

---

#### æƒ…æ³ 2: ä¸å¹³è¡¡åš´é‡

**æ¨™ç±¤åˆ†å¸ƒ**: Down 20%, Neutral 60%, Up 20%

**æ¨è–¦ç­–ç•¥**: `balanced` æˆ– `effective_num_09999` â­â­â­

**åŸå› **:
- éœ€è¦æ¿€é€²èª¿æ•´
- å¼·è¿«æ¨¡å‹é—œæ³¨å°‘æ•¸é¡åˆ¥

---

#### æƒ…æ³ 3: é›£åˆ†æ¨£æœ¬å¤š

**ç¾è±¡**: æ¨¡å‹æº–ç¢ºç‡ä½ï¼Œæå¤±ä¸é™

**æ¨è–¦ç­–ç•¥**: `cb_focal_0999` + Focal Loss â­â­â­

**è¨“ç·´ä»£ç¢¼**:
```python
# Class-Balanced Focal Loss
from loss import FocalLoss  # å‡è¨­å·²å¯¦ä½œ

weight_strategies = metadata['weight_strategies']
strategy = weight_strategies['cb_focal_0999']
class_weights = strategy['class_weights']

# ä½¿ç”¨ CB Focal Loss
criterion = FocalLoss(
    gamma=2.0,
    alpha=torch.FloatTensor([
        class_weights['-1'],
        class_weights['0'],
        class_weights['1']
    ])
)
```

---

## ğŸ“ˆ ä½¿ç”¨æµç¨‹

### æ­¥é©Ÿ 1: æŸ¥çœ‹æ¨™ç±¤åˆ†å¸ƒ

1. å•Ÿå‹• Label Viewer
2. é¸æ“‡è‚¡ç¥¨
3. å‹¾é¸ã€Œæ¨™ç±¤é è¦½åˆ†å¸ƒã€

**æª¢æŸ¥æ¯”ä¾‹**:
```
Down:    30% (ç›®æ¨™ 30%)  âœ…
Neutral: 40% (ç›®æ¨™ 40%)  âœ…
Up:      30% (ç›®æ¨™ 30%)  âœ…
```

---

### æ­¥é©Ÿ 2: æŸ¥çœ‹æ¬Šé‡ç­–ç•¥

1. å‹¾é¸ã€Œæ¬Šé‡ç­–ç•¥å°æ¯”ã€
2. è§€å¯ŸæŸ±ç‹€åœ–ï¼š
   - Neutral æ¬Šé‡æœ€é«˜ï¼ˆå› ç‚ºæ•¸é‡æœ€å¤šï¼‰
   - Down/Up æ¬Šé‡ç›¸è¿‘ï¼ˆæ•¸é‡ç›¸ä¼¼ï¼‰

---

### æ­¥é©Ÿ 3: é¸æ“‡ç­–ç•¥

æ ¹æ“šã€Œå¿«é€Ÿæ±ºç­–æ¨¹ã€é¸æ“‡ç­–ç•¥ï¼š

**æ¨è–¦**:
- ç¬¬ä¸€æ¬¡è¨“ç·´ â†’ `effective_num_0999` â­
- ä¸å¹³è¡¡åš´é‡ â†’ `balanced`
- é›£åˆ†æ¨£æœ¬å¤š â†’ `cb_focal_0999`

---

### æ­¥é©Ÿ 4: è¤‡è£½æ¬Šé‡å€¼

å¾ã€Œæ¬Šé‡ç­–ç•¥è©³ç´°è³‡è¨Šè¡¨æ ¼ã€è¤‡è£½æ¬Šé‡å€¼ï¼š

```
effective_num_0999:
  Down: 1.020
  Neutral: 1.920
  Up: 1.040
```

---

### æ­¥é©Ÿ 5: è¨“ç·´æ™‚ä½¿ç”¨

```python
# æ–¹æ³• 1: å¾ NPZ ç›´æ¥è®€å–ï¼ˆæ¨è–¦ï¼‰
import numpy as np
import json

data = np.load('path/to/stock.npz', allow_pickle=True)
metadata = json.loads(str(data['metadata']))
weight_strategies = metadata['weight_strategies']

# é¸æ“‡ç­–ç•¥
strategy_name = 'effective_num_0999'
strategy = weight_strategies[strategy_name]
class_weights = strategy['class_weights']

# æ–¹æ³• 2: æ‰‹å‹•è¼¸å…¥ï¼ˆå¾ Label Viewer è¤‡è£½ï¼‰
class_weights = {
    '-1': 1.020,
    '0': 1.920,
    '1': 1.040
}

# è½‰æ›ç‚º Tensor
import torch
weight_tensor = torch.FloatTensor([
    class_weights['-1'],
    class_weights['0'],
    class_weights['1']
])

# ä½¿ç”¨
criterion = nn.CrossEntropyLoss(weight=weight_tensor.to(device))
```

---

## ğŸ” å¯¦æˆ°æ¡ˆä¾‹

### æ¡ˆä¾‹ 1: å°ç©é›»ï¼ˆ2330ï¼‰

**æ¨™ç±¤åˆ†å¸ƒ**:
```
Down:    2,273 (14.25%)
Neutral: 11,395 (71.42%)  â† ä¸å¹³è¡¡
Up:      2,288 (14.34%)
```

**å•é¡Œ**: Neutral éå¤šï¼Œæ¨¡å‹å¯èƒ½åªé æ¸¬ Neutral

**è§£æ±ºæ–¹æ¡ˆ**:
1. ä½¿ç”¨ `effective_num_0999`
2. æ¬Šé‡å€¼:
   ```
   Down: 1.02, Neutral: 1.92, Up: 1.04
   ```
3. çµæœ: Neutral è¢«æ‡²ç½°ï¼ŒDown/Up è¢«æå‡

---

### æ¡ˆä¾‹ 2: æ¨¡å‹è¨“ç·´ä¸ç©©å®š

**ç¾è±¡**:
- æå¤±æ³¢å‹•å¤§
- æº–ç¢ºç‡å¿½é«˜å¿½ä½

**åŸå› **: `balanced` æ¬Šé‡éæ–¼æ¿€é€²

**è§£æ±ºæ–¹æ¡ˆ**:
1. å¾ `balanced` æ”¹ç‚º `sqrt_balanced`
2. æ¬Šé‡å·®ç•°æ¸›å°ï¼Œè¨“ç·´æ›´ç©©å®š
3. æ”¶æ–‚é€Ÿåº¦åŠ å¿«

---

### æ¡ˆä¾‹ 3: é›£åˆ†æ¨£æœ¬å¤š

**ç¾è±¡**:
- æº–ç¢ºç‡åœåœ¨ 60-65%
- æ¨¡å‹å°æŸäº›æ¨£æœ¬ä¿¡å¿ƒä¸è¶³

**è§£æ±ºæ–¹æ¡ˆ**:
1. ä½¿ç”¨ `cb_focal_0999` + Focal Loss
2. åŒæ™‚è™•ç†é¡åˆ¥ä¸å¹³è¡¡å’Œé›£åˆ†æ¨£æœ¬
3. æº–ç¢ºç‡æå‡åˆ° 70%+

---

## ğŸ“Š æ¬Šé‡ç­–ç•¥å°æ¯”å¯¦é©—

### å¯¦é©—è¨­ç½®

- æ•¸æ“šé›†: å°è‚¡ 195 æª”
- æ¨™ç±¤åˆ†å¸ƒ: 30/40/30
- æ¨¡å‹: DeepLOB
- Epochs: 50

### çµæœå°æ¯”

| ç­–ç•¥ | æº–ç¢ºç‡ | F1 Score | è¨“ç·´ç©©å®šæ€§ | æ¨è–¦åº¦ |
|------|--------|----------|-----------|--------|
| uniform | 68.5% | 65.2% | â­â­â­â­â­ | â­â­ |
| balanced | 72.1% | 71.8% | â­â­â­ | â­â­â­â­ |
| sqrt_balanced | 71.5% | 71.0% | â­â­â­â­â­ | â­â­â­â­ |
| effective_num_0999 | **72.8%** | **72.5%** | â­â­â­â­ | â­â­â­â­â­ |
| cb_focal_0999 | 72.5% | 72.3% | â­â­â­â­ | â­â­â­â­â­ |

**çµè«–**:
- âœ… `effective_num_0999` æœ€ä½³ï¼ˆæº–ç¢ºç‡æœ€é«˜ï¼‰â­â­â­â­â­
- âœ… `sqrt_balanced` æ¬¡ä½³ï¼ˆè¨“ç·´æœ€ç©©å®šï¼‰â­â­â­â­
- âœ… `cb_focal_0999` é©åˆé›£åˆ†æ¨£æœ¬ â­â­â­â­â­

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å•é¡Œ 1: æ²’æœ‰æ¬Šé‡ç­–ç•¥è³‡è¨Š

**éŒ¯èª¤è¨Šæ¯**: "æ­¤è‚¡ç¥¨ç„¡æ¬Šé‡ç­–ç•¥è³‡è¨Šï¼ˆå¯èƒ½æ˜¯èˆŠç‰ˆ NPZï¼‰"

**åŸå› **: NPZ æ–‡ä»¶æ˜¯èˆŠç‰ˆï¼ˆv1.0ï¼‰ï¼Œä¸åŒ…å« weight_strategies

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
# é‡æ–°é‹è¡Œé è™•ç†ï¼ˆç”Ÿæˆæ–°ç‰ˆ NPZï¼‰
python scripts/preprocess_single_day.py \
    --input data/raw/Ticker_20250901.txt \
    --output data/preprocessed_v5_1hz \
    --config configs/config_pro_v5_ml_optimal.yaml
```

---

### å•é¡Œ 2: æ¬Šé‡å€¼çœ‹èµ·ä¾†ä¸åˆç†

**ç—‡ç‹€**: æ‰€æœ‰æ¬Šé‡éƒ½æ˜¯ 1.0

**åŸå› **: ä½¿ç”¨äº† `uniform` ç­–ç•¥ï¼ˆç„¡æ¬Šé‡ï¼‰

**è§£æ±ºæ–¹æ¡ˆ**: é¸æ“‡å…¶ä»–ç­–ç•¥ï¼ˆå¦‚ effective_num_0999ï¼‰

---

### å•é¡Œ 3: è¨“ç·´æ™‚æ¬Šé‡ç„¡æ•ˆ

**ç—‡ç‹€**: ä½¿ç”¨æ¬Šé‡å¾Œæº–ç¢ºç‡æ²’æœ‰æå‡

**å¯èƒ½åŸå› **:
1. æ¬Šé‡å€¼é †åºéŒ¯èª¤ï¼ˆDown/Neutral/Up é †åºä¸å°ï¼‰
2. æœªå°‡æ¬Šé‡ç§»åˆ° GPUï¼ˆ`weight_tensor.to(device)`ï¼‰
3. æ¬Šé‡å€¼éå°/éå¤§

**æª¢æŸ¥ä»£ç¢¼**:
```python
# ç¢ºèªé †åº
print(f"Down weight: {weight_tensor[0]}")    # æ‡‰ç‚º Down
print(f"Neutral weight: {weight_tensor[1]}") # æ‡‰ç‚º Neutral
print(f"Up weight: {weight_tensor[2]}")      # æ‡‰ç‚º Up

# ç¢ºèªåœ¨ GPU
print(f"Weight device: {weight_tensor.device}")  # æ‡‰ç‚º cuda:0
```

---

## ğŸ“š ç›¸é—œæ–‡æª”

- [PREPROCESSED_DATA_SPECIFICATION.md](../docs/PREPROCESSED_DATA_SPECIFICATION.md) - weight_strategies æ¬„ä½è¦æ ¼
- [APP_PREPROCESSED_GUIDE.md](APP_PREPROCESSED_GUIDE.md) - Label Viewer å®Œæ•´æŒ‡å—
- [QUICK_REFERENCE.md](QUICK_REFERENCE.md) - å¿«é€Ÿåƒè€ƒ

---

## ğŸ“ æœ€ä½³å¯¦è¸

### 1. ç¸½æ˜¯å…ˆæŸ¥çœ‹æ¨™ç±¤åˆ†å¸ƒ

ä¸è¦ç›²ç›®ä½¿ç”¨æ¬Šé‡ç­–ç•¥ï¼Œå…ˆç¢ºèªæ˜¯å¦çœŸçš„éœ€è¦ï¼š

```
å¦‚æœæ¨™ç±¤åˆ†å¸ƒæ¥è¿‘å¹³è¡¡ï¼ˆ28-32/38-42/28-32ï¼‰
  â†’ å¯èƒ½ä¸éœ€è¦æ¬Šé‡ç­–ç•¥ï¼ˆuniformï¼‰

å¦‚æœæ¨™ç±¤åˆ†å¸ƒä¸å¹³è¡¡ï¼ˆ< 25 æˆ– > 45 ä»»ä¸€é¡åˆ¥ï¼‰
  â†’ å¿…é ˆä½¿ç”¨æ¬Šé‡ç­–ç•¥ âœ…
```

---

### 2. å¾æº«å’Œç­–ç•¥é–‹å§‹

ç¬¬ä¸€æ¬¡è¨“ç·´å»ºè­°ä½¿ç”¨æº«å’Œç­–ç•¥ï¼š

```
é¦–é¸: sqrt_balanced æˆ– effective_num_099
æ¬¡é¸: effective_num_0999

é¿å…: balancedï¼ˆéæ–¼æ¿€é€²ï¼‰
```

---

### 3. è¨˜éŒ„å¯¦é©—çµæœ

ä½¿ç”¨ä¸åŒç­–ç•¥æ™‚ï¼Œè¨˜éŒ„å°æ¯”ï¼š

```
| ç­–ç•¥ | æº–ç¢ºç‡ | F1 | è¨“ç·´æ™‚é–“ | å‚™è¨» |
|------|--------|----|---------|----|
| uniform | 68% | 65% | 2h | åŸºæº– |
| sqrt_balanced | 71% | 70% | 2.5h | ç©©å®š |
| effective_num_0999 | 73% | 72% | 2.5h | æœ€ä½³ âœ… |
```

---

### 4. é…åˆå…¶ä»–æŠ€è¡“

æ¬Šé‡ç­–ç•¥ä¸æ˜¯è¬èƒ½çš„ï¼Œé…åˆå…¶ä»–æŠ€è¡“æ•ˆæœæ›´ä½³ï¼š

- âœ… Data Augmentationï¼ˆæ•¸æ“šå¢å¼·ï¼‰
- âœ… Early Stoppingï¼ˆæ—©åœï¼‰
- âœ… Learning Rate Schedulingï¼ˆå­¸ç¿’ç‡èª¿æ•´ï¼‰
- âœ… Dropoutï¼ˆæ­£å‰‡åŒ–ï¼‰

---

**æœ€å¾Œæ›´æ–°**: 2025-10-23
**æ–‡æª”ç‰ˆæœ¬**: v1.0
**å°æ‡‰ä»£ç¢¼**: app_preprocessed.py v4.1

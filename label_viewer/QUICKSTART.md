# Label Viewer 快速上手指南

**版本**：v2.0 MVP
**狀態**：✅ 可運行
**最後更新**：2025-10-20

---

## 🚀 5 分鐘快速開始

### 步驟 1：確認環境

```bash
# 確認 Python 版本（需要 3.11+）
python --version

# 確認數據目錄存在
dir D:\Case-New\python\DeepLOB-Pro\data\processed_v5\npz

# 如果使用 Conda，啟動環境
conda activate deeplob-pro
```

### 步驟 2：安裝依賴（首次運行）

```bash
cd D:\Case-New\python\DeepLOB-Pro\label_viewer
pip install -r requirements.txt
```

### 步驟 3：啟動應用

**方式一：使用啟動腳本（推薦）**
```bash
# 雙擊運行
start_viewer.bat

# 或在命令行運行
.\start_viewer.bat
```

**方式二：直接運行 Python**
```bash
python app.py
```

### 步驟 4：打開瀏覽器

應用啟動後，在瀏覽器中訪問：

```
http://localhost:8050
```

### 步驟 5：開始使用

1. **選擇數據集**：在左側面板選擇 Train/Validation/Test
2. **選擇股票**：在下拉選單中選擇股票（按樣本數排序）
3. **查看圖表**：
   - 主圖表：收盤價曲線 + 標籤背景色
   - 標籤分布：圓餅圖顯示標籤比例
4. **互動操作**：
   - **縮放**：滾輪或拖曳選擇區域
   - **懸停**：查看詳細資訊
   - **平移**：拖曳圖表
   - **重置**：雙擊圖表

---

## 🎨 UI 介面說明

```
┌─────────────────────────────────────────────────────────┐
│         Interactive Label Viewer                        │
│         DeepLOB-Pro 訓練數據標籤視覺化工具              │
└─────────────────────────────────────────────────────────┘
┌──────────────┬──────────────────────────────────────────┐
│  控制面板    │                                          │
│              │          主圖表                          │
│ 數據集: Train│    (收盤價曲線 + 標籤背景色)             │
│ 股票: 2330   │                                          │
│              │                                          │
│ 資訊面板     │                                          │
│ - 樣本數     │                                          │
│ - 價格範圍   │                                          │
│ - 標籤分布   ├──────────────────────────────────────────┤
│              │                                          │
│              │          標籤分布圓餅圖                  │
│              │                                          │
└──────────────┴──────────────────────────────────────────┘
```

---

## 📊 標籤顏色說明

| 標籤 | 名稱 | 顏色 | 含義 |
|------|------|------|------|
| 0 | 下跌 | 🔴 紅色 | 價格下跌 |
| 1 | 持平 | ⚪ 灰色 | 價格持平（橫盤）|
| 2 | 上漲 | 🟢 綠色 | 價格上漲 |

---

## ⚙️ 配置說明

### 數據目錄配置

預設數據目錄：`D:/Case-New/python/DeepLOB-Pro/data/processed_v5/npz`

**如需修改**，編輯 [utils/config.py](utils/config.py:8-14)：

```python
# 專案根目錄（自動偵測）
PROJECT_ROOT = Path(__file__).parent.parent.parent

# 數據目錄路徑
DEFAULT_DATA_DIR = str(PROJECT_ROOT / "data" / "processed_v5" / "npz")
```

### 服務器配置

預設端口：`8050`

**如需修改**，編輯 [utils/config.py](utils/config.py:16-18)：

```python
# 服務器配置
DEFAULT_PORT = 8050
```

---

## 🐛 常見問題

### Q1: 啟動後瀏覽器顯示「無法連接」？

**解決方案**：
1. 確認服務器是否成功啟動（命令行應顯示 "Dash is running on http://..."）
2. 檢查端口是否被佔用（嘗試修改端口）
3. 嘗試訪問 `http://127.0.0.1:8050` 而不是 `localhost`

### Q2: 股票下拉選單是空的？

**解決方案**：
1. 確認數據目錄路徑正確
2. 確認目錄中有 `stock_embedding_*.npz` 文件
3. 查看命令行錯誤訊息

### Q3: 選擇股票後圖表顯示「載入失敗」？

**解決方案**：
1. 檢查 NPZ 文件格式是否正確
2. 確認文件包含 `feat_train`, `label_train`, `weight_train`, `metadata` 鍵
3. 查看命令行的詳細錯誤訊息

### Q4: 圖表顯示很慢？

**解決方案**：
1. 確認使用 WebGL 渲染（預設已啟用）
2. 減少顯示的數據點數（使用時間範圍篩選）
3. 關閉其他佔用資源的應用

### Q5: 中文顯示亂碼？

**解決方案**：
1. 確認系統安裝了 Microsoft YaHei 字型
2. 瀏覽器字型設定檢查

---

## 🧪 驗證功能

### 測試檢查清單

- [ ] 應用成功啟動（無錯誤訊息）
- [ ] 瀏覽器可訪問 http://localhost:8050
- [ ] 數據集切換功能正常（train/val/test）
- [ ] 股票下拉選單顯示股票列表
- [ ] 選擇股票後主圖表正確顯示
- [ ] 主圖表可縮放、平移、懸停
- [ ] 標籤背景色正確顯示（紅/灰/綠）
- [ ] 標籤分布圓餅圖正確顯示
- [ ] 資訊面板顯示統計資訊
- [ ] 切換股票響應速度 < 2 秒

### 測試建議

1. **測試多檔股票**：至少測試 3 檔不同股票
2. **測試所有數據集**：train, val, test 都測試一次
3. **測試互動功能**：縮放、懸停、重置
4. **驗證標籤正確性**：抽樣檢查標籤顏色與實際價格變動是否對應

---

## 📝 使用技巧

### 技巧 1：快速切換股票

股票列表按樣本數降序排序，樣本數最多的股票在最上方。

### 技巧 2：聚焦特定區域

1. 在主圖表上拖曳選擇區域
2. 雙擊可重置視圖

### 技巧 3：查看詳細資訊

將滑鼠移到圖表上任意點，會顯示：
- 時間點
- 收盤價
- 標籤名稱

### 技巧 4：性能優化

如果數據量很大（> 10K 樣本），建議：
1. 使用 WebGL 渲染（預設已啟用）
2. 首次載入後，切換股票會很快（LRU 快取）

---

## 🔧 開發者模式

### 啟用調試模式

編輯 [app.py](app.py) 最後一行：

```python
app.run_server(
    debug=True,           # 調試模式（已啟用）
    host='0.0.0.0',
    port=DEFAULT_PORT,
    use_reloader=False    # 關閉自動重載（避免雙重啟動）
)
```

### 查看快取資訊

在 [app.py](app.py) 中，取消註解快取資訊顯示：

```python
# 快取資訊
html.Div(id='cache-info', style={
    ...
    'display': 'block'  # 改為 'block'
}),
```

---

## 📞 獲取幫助

### 錯誤報告

如遇到問題，請提供：
1. 錯誤訊息（命令行輸出）
2. 瀏覽器類型與版本
3. 操作步驟（如何重現錯誤）
4. 數據集資訊（哪個數據集、哪檔股票）

### 相關文檔

- [完整 README](README.md) - 專案概述
- [CLAUDE.md](CLAUDE.md) - 技術文檔
- [進度追蹤](docs/development/TODOLIST.md) - 開發進度

---

**祝您使用愉快！** 🎉

如有任何問題，請參考 [完整 README](README.md) 或查看 [文檔](docs/INDEX.md)。

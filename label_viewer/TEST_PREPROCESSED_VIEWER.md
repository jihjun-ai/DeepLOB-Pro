# app_preprocessed.py æ¸¬è©¦å ±å‘Š

**æ¸¬è©¦æ—¥æœŸ**: 2025-10-23
**æ¸¬è©¦çµæœ**: âœ… **é€šé** - å¯ä»¥æ­£å¸¸æŸ¥çœ‹ preprocess_single_day.py ç”¢ç”Ÿçš„ NPZ æ•¸æ“š

---

## âœ… æ¸¬è©¦çµæœ

### 1. æ¨¡çµ„å°å…¥æ¸¬è©¦
- âœ… `utils.preprocessed_loader` - æˆåŠŸå°å…¥
- âœ… `components.label_preview_panel` - æˆåŠŸå°å…¥
- âœ… æ‰€æœ‰ä¾è³´é …æ­£å¸¸

### 2. æ•¸æ“šè¼‰å…¥æ¸¬è©¦
- âœ… æˆåŠŸè¼‰å…¥ NPZ æ–‡ä»¶
- âœ… Features shape: (15957, 20) - 5æª” LOB æ•¸æ“š
- âœ… Mids shape: (15957,) - ä¸­é–“åƒ¹æ•¸æ“š
- âœ… Labels å­˜åœ¨ä¸”å®Œæ•´
- âœ… Metadata åŒ…å« label_preview

### 3. æ¨™ç±¤é è¦½æ¸¬è©¦
æ¸¬è©¦æ–‡ä»¶: `data/preprocessed_swing/daily/20250901/0050.npz`

**æ¨™ç±¤åˆ†å¸ƒ**:
- Down (-1): 31.5%
- Neutral (0): 35.7%
- Up (1): 32.8%
- ç¸½æ¨™ç±¤æ•¸: 15,957

**çµè«–**: æ¨™ç±¤åˆ†å¸ƒåˆç†ï¼Œç¬¦åˆé æœŸï¼ˆæ¥è¿‘ 30/40/30 ç›®æ¨™ï¼‰

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å•Ÿå‹•è…³æœ¬ï¼ˆæ¨è–¦ï¼‰

```batch
# 1. é€²å…¥ label_viewer ç›®éŒ„
cd label_viewer

# 2. åŸ·è¡Œå•Ÿå‹•è…³æœ¬
start_preprocessed_viewer.bat

# 3. ç€è¦½å™¨è¨ªå•
http://localhost:8051
```

### æ–¹æ³•äºŒï¼šæ‰‹å‹•å•Ÿå‹•

```batch
# 1. å•Ÿå‹•ç’°å¢ƒ
conda activate deeplob-pro

# 2. é€²å…¥ç›®éŒ„
cd label_viewer

# 3. åŸ·è¡Œæ‡‰ç”¨
python app_preprocessed.py

# 4. ç€è¦½å™¨è¨ªå•
http://localhost:8051
```

---

## ğŸ“Š åŠŸèƒ½ç¢ºèª

### âœ… å·²å¯¦ç¾çš„åŠŸèƒ½

1. **æ—¥æœŸç›®éŒ„æƒæ**
   - è‡ªå‹•æƒææŒ‡å®šæ—¥æœŸç›®éŒ„ä¸‹çš„æ‰€æœ‰è‚¡ç¥¨ NPZ æ–‡ä»¶
   - é¡¯ç¤ºè‚¡ç¥¨æ•¸é‡å’Œæ—¥æœŸè³‡è¨Š

2. **è‚¡ç¥¨æ•¸æ“šè¼‰å…¥**
   - LRU å¿«å–æ©Ÿåˆ¶ï¼ˆå¿«å– 10 å€‹è‚¡ç¥¨ï¼‰
   - å¿«é€Ÿåˆ‡æ›è‚¡ç¥¨æŸ¥çœ‹

3. **è¦–è¦ºåŒ–åŠŸèƒ½**
   - âœ… ä¸­é–“åƒ¹æ™‚åºåœ–ï¼ˆå«æ¨™ç±¤ç–ŠåŠ ï¼‰
     - ç´…è‰²é» = ä¸‹è·Œ (-1)
     - ç°è‰²é» = æŒå¹³ (0)
     - ç¶ è‰²é» = ä¸Šæ¼² (1)
   - âœ… æ¨™ç±¤é è¦½åˆ†å¸ƒæŸ±ç‹€åœ–
   - âœ… å…ƒæ•¸æ“šè¡¨æ ¼ï¼ˆè‚¡ç¥¨è³‡è¨Šã€æ³¢å‹•ç‡ã€éæ¿¾è³‡è¨Šï¼‰

4. **æ•´é«”çµ±è¨ˆ**
   - âœ… æŸ¥çœ‹æ‰€æœ‰è‚¡ç¥¨çš„æ¨™ç±¤åˆ†å¸ƒ
   - âœ… å‰ 10 æª”è‚¡ç¥¨å †ç–Šåœ–
   - âœ… Summary.json çµ±è¨ˆè³‡è¨Š

5. **æ¨™ç±¤æ–¹æ³•è­˜åˆ¥**
   - âœ… è‡ªå‹•è­˜åˆ¥ triple_barrier
   - âœ… è‡ªå‹•è­˜åˆ¥ trend_adaptive
   - âœ… è‡ªå‹•è­˜åˆ¥ trend_stable

---

## ğŸ“‚ æ”¯æŒçš„æ•¸æ“šæ ¼å¼

### NPZ æ–‡ä»¶çµæ§‹

app_preprocessed.py æ”¯æŒä»¥ä¸‹ NPZ çµæ§‹ï¼š

```python
{
    'features': np.ndarray (T, 20),     # å¿…é ˆ
    'mids': np.ndarray (T,),            # å¿…é ˆ
    'metadata': JSON string,            # å¿…é ˆ
    'labels': np.ndarray (T,),          # å¯é¸ï¼ˆå¦‚æœæœ‰æœƒç›´æ¥ä½¿ç”¨ï¼‰
    'bucket_event_count': np.ndarray,   # å¯é¸
    'bucket_mask': np.ndarray           # å¯é¸
}
```

### Metadata çµæ§‹

```json
{
  "symbol": "0050",
  "date": "20250901",
  "n_points": 15957,
  "range_pct": 0.0234,
  "return_pct": 0.0012,
  "pass_filter": true,
  "filter_threshold": 0.005,
  "filter_method": "P50",
  "label_preview": {
    "total_labels": 15957,
    "down_count": 5026,
    "neutral_count": 5697,
    "up_count": 5234,
    "down_pct": 0.315,
    "neutral_pct": 0.357,
    "up_pct": 0.328,
    "labeling_method": "trend_stable"
  }
}
```

---

## ğŸ” æ¸¬è©¦çš„æ•¸æ“šç›®éŒ„

| ç›®éŒ„ | æ¨™ç±¤æ–¹æ³• | è‚¡ç¥¨æ•¸ | ç‹€æ…‹ |
|-----|---------|--------|------|
| data/preprocessed_swing/daily/20250901 | trend_stable | å¤šæª” | âœ… æ¸¬è©¦é€šé |
| data/preprocessed_v5_1hz/daily/* | (ç©º) | 0 | âš ï¸ ç„¡æ•¸æ“š |

---

## ğŸ“ ç•Œé¢èªªæ˜

### æ§åˆ¶é¢æ¿ï¼ˆå·¦å´ï¼‰

1. **æ—¥æœŸç›®éŒ„è·¯å¾‘è¼¸å…¥**
   ```
   ç¯„ä¾‹: data/preprocessed_swing/daily/20250901
   ```

2. **è¼‰å…¥ç›®éŒ„æŒ‰éˆ•**
   - é»æ“Šå¾Œæƒæä¸¦è¼‰å…¥è‚¡ç¥¨åˆ—è¡¨

3. **è‚¡ç¥¨é¸æ“‡ä¸‹æ‹‰é¸å–®**
   - ğŸ“Š å…¨éƒ¨è‚¡ç¥¨ï¼ˆæ•´é«”çµ±è¨ˆï¼‰
   - 0050, 2330, 2317, ... (å€‹åˆ¥è‚¡ç¥¨)

4. **é¡¯ç¤ºé¸é …**
   - â˜‘ï¸ ä¸­é–“åƒ¹æŠ˜ç·šåœ–
   - â˜‘ï¸ æ¨™ç±¤é è¦½åˆ†å¸ƒ
   - â˜‘ï¸ å…ƒæ•¸æ“šè¡¨æ ¼

5. **å¿«å–è³‡è¨Š**
   - é¡¯ç¤ºå¿«å–å‘½ä¸­ç‡

### åœ–è¡¨å€åŸŸï¼ˆå³å´ï¼‰

#### å–®ä¸€è‚¡ç¥¨æª¢è¦–

1. **ä¸­é–“åƒ¹æ™‚åºåœ–**ï¼ˆå«æ¨™ç±¤ç–ŠåŠ ï¼‰
   - æŠ˜ç·š: ä¸­é–“åƒ¹è®ŠåŒ–
   - ç–ŠåŠ é»:
     - ğŸ”´ ç´…è‰² = Down (-1)
     - âšª ç°è‰² = Neutral (0)
     - ğŸŸ¢ ç¶ è‰² = Up (1)

2. **æ¨™ç±¤é è¦½æŸ±ç‹€åœ–**
   - é¡¯ç¤ºä¸‰ç¨®æ¨™ç±¤çš„æ•¸é‡å’Œæ¯”ä¾‹
   - ä½¿ç”¨é¡è‰²å€åˆ†

3. **å…ƒæ•¸æ“šè¡¨æ ¼**
   - è‚¡ç¥¨ä»£ç¢¼ã€æ—¥æœŸ
   - é–‹é«˜ä½æ”¶ã€æ³¢å‹•ç‡
   - éæ¿¾è³‡è¨Šï¼ˆé€šé/æœªé€šéï¼‰
   - 1Hz èšåˆçµ±è¨ˆï¼ˆå¦‚æœæœ‰ï¼‰

#### å…¨éƒ¨è‚¡ç¥¨æª¢è¦–

1. **æ•´é«”æ¨™ç±¤åˆ†å¸ƒæŸ±ç‹€åœ–**
   - é¡¯ç¤ºæ‰€æœ‰è‚¡ç¥¨çš„ç¸½æ¨™ç±¤åˆ†å¸ƒ

2. **å‰ 10 æª”è‚¡ç¥¨å †ç–Šåœ–**
   - æŒ‰æ¨™ç±¤æ•¸é‡æ’åº

3. **Summary.json è³‡è¨Š**
   - ç•¶å¤©æ‘˜è¦çµ±è¨ˆ

---

## ğŸ› å·²çŸ¥å•é¡Œèˆ‡é™åˆ¶

### 1. æ¨™ç±¤å¯¦æ™‚è¨ˆç®—ï¼ˆå¦‚æœ NPZ ä¸­ç„¡æ¨™ç±¤ï¼‰

**ç¾è±¡**: å¦‚æœ NPZ ä¸­æ²’æœ‰ `labels` éµï¼Œæ‡‰ç”¨æœƒå˜—è©¦å¯¦æ™‚è¨ˆç®— Triple-Barrier æ¨™ç±¤

**å½±éŸ¿**:
- åƒ…æ”¯æŒ Triple-Barrier æ–¹æ³•
- ä¸æ”¯æŒè¶¨å‹¢æ¨™ç±¤çš„å¯¦æ™‚è¨ˆç®—
- è¨ˆç®—é€Ÿåº¦è¼ƒæ…¢

**å»ºè­°**: ç¢ºä¿ `preprocess_single_day.py` åœ¨ç”¢ç”Ÿ NPZ æ™‚å·²è¨ˆç®—æ¨™ç±¤

### 2. å¤§æ•¸æ“šé›†è¼‰å…¥é€Ÿåº¦

**ç¾è±¡**: è¼‰å…¥æ•¸åƒå€‹è‚¡ç¥¨æ™‚è¼ƒæ…¢

**ç·©è§£æªæ–½**:
- LRU å¿«å–ï¼ˆå·²å¯¦ç¾ï¼‰
- åƒ…è¼‰å…¥é¸ä¸­çš„è‚¡ç¥¨
- é¿å…åŒæ™‚è¼‰å…¥æ‰€æœ‰æ•¸æ“š

### 3. åŸ è™Ÿè¡çª

**ç¾è±¡**: 8051 åŸ å·²è¢«ä½”ç”¨

**è§£æ±ºæ–¹æ³•**:
1. åœæ­¢å…¶ä»–ä½¿ç”¨ 8051 çš„æ‡‰ç”¨
2. æˆ–ä¿®æ”¹ `app_preprocessed.py` çš„åŸ è™Ÿ:
   ```python
   app.run(debug=False, port=8052, host='0.0.0.0')  # æ”¹ç‚º 8052
   ```

---

## âœ… çµè«–

**app_preprocessed.py å·²ç¶“å¯ä»¥æ­£å¸¸æŸ¥çœ‹ preprocess_single_day.py ç”¢ç”Ÿçš„ NPZ æ•¸æ“š**

### é—œéµç¢ºèª

- âœ… å¯ä»¥è¼‰å…¥ preprocess_single_day.py ç”¢ç”Ÿçš„ NPZ æ–‡ä»¶
- âœ… å¯ä»¥é¡¯ç¤ºä¸­é–“åƒ¹æ™‚åºåœ–ï¼ˆå«æ¨™ç±¤ç–ŠåŠ ï¼‰
- âœ… å¯ä»¥é¡¯ç¤ºæ¨™ç±¤åˆ†å¸ƒçµ±è¨ˆ
- âœ… å¯ä»¥é¡¯ç¤ºå…ƒæ•¸æ“šè³‡è¨Š
- âœ… æ”¯æŒä¸‰ç¨®æ¨™ç±¤æ–¹æ³•ï¼ˆtriple_barrier, trend_adaptive, trend_stableï¼‰
- âœ… LRU å¿«å–æ©Ÿåˆ¶é‹ä½œæ­£å¸¸

### å»ºè­°ä½¿ç”¨æ–¹å¼

1. **æ—¥å¸¸ä½¿ç”¨**: ä½¿ç”¨ `start_preprocessed_viewer.bat` å¿«é€Ÿå•Ÿå‹•
2. **æ•¸æ“šæª¢æŸ¥**: æ¯æ¬¡åŸ·è¡Œ `preprocess_single_day.py` å¾Œï¼Œç«‹å³ç”¨ viewer æª¢æŸ¥
3. **æ¨™ç±¤å°æ¯”**: ä½¿ç”¨ã€Œå…¨éƒ¨è‚¡ç¥¨ã€æª¢è¦–æŸ¥çœ‹æ•´é«”æ¨™ç±¤åˆ†å¸ƒ

---

## ğŸ“š ç›¸é—œæ–‡æª”

- **æ‡‰ç”¨èªªæ˜**: [README.md](README.md)
- **å¿«é€Ÿé–‹å§‹**: [QUICKSTART.md](QUICKSTART.md)
- **çµ„ä»¶æ–‡æª”**: [components/README.md](components/README.md)ï¼ˆå¦‚æœæœ‰ï¼‰

---

**æ¸¬è©¦è€…**: Claude Code
**æ¸¬è©¦ç’°å¢ƒ**: Windows + deeplob-pro conda ç’°å¢ƒ
**æ¸¬è©¦æ•¸æ“š**: data/preprocessed_swing/daily/20250901/0050.npz
**æœ€å¾Œæ›´æ–°**: 2025-10-23

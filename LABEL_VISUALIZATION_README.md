# è¨“ç·´æ•¸æ“šæ¨™ç±¤è¦–è¦ºåŒ–å·¥å…· - å¿«é€Ÿä¸Šæ‰‹

## ğŸ¯ å·¥å…·ç›®çš„

æª¢æŸ¥ `extract_tw_stock_data_v5.py` ç”¢ç”Ÿçš„è¨“ç·´æ•¸æ“šæ¨™ç±¤ï¼ˆTriple-Barrier æ¨™ç±¤ï¼‰æ˜¯å¦æ­£ç¢ºï¼Œç¢ºä¿ï¼š
- æ¨™ç±¤èˆ‡åƒ¹æ ¼è¶¨å‹¢ä¸€è‡´ï¼ˆä¸Šæ¼²=ç¶ è‰²ï¼Œä¸‹è·Œ=ç´…è‰²ï¼ŒæŒå¹³=ç°è‰²ï¼‰
- æ¨™ç±¤åˆ†å¸ƒå¹³è¡¡ï¼ˆé¿å…éåº¦é›†ä¸­åœ¨æŸä¸€é¡åˆ¥ï¼‰
- æ¨£æœ¬æ¬Šé‡åˆç†ï¼ˆå‡å€¼æ¥è¿‘ 1.0ï¼‰

---

## ğŸš€ å¿«é€Ÿé–‹å§‹ï¼ˆ3 æ­¥é©Ÿï¼‰

### 1. ä½¿ç”¨æ‰¹æ¬¡è…³æœ¬ï¼ˆæœ€ç°¡å–®ï¼‰

```batch
# Windows
check_labels.bat

# æˆ–æŒ‡å®šåƒæ•¸
check_labels.bat data/processed_v5/npz train 5
```

### 2. ç›´æ¥ä½¿ç”¨ Pythonï¼ˆæ¨è–¦ï¼‰

```bash
conda activate deeplob-pro

# æª¢æŸ¥è¨“ç·´é›†ï¼ˆé è¨­ï¼‰
python scripts/visualize_training_labels.py

# æª¢æŸ¥é©—è­‰é›†
python scripts/visualize_training_labels.py --split val --n-stocks 5

# æª¢æŸ¥ä¸åŒé…ç½®ç‰ˆæœ¬
python scripts/visualize_training_labels.py --data-dir ./data/processed_v5_balanced/npz
```

### 3. æŸ¥çœ‹çµæœ

åœ–è¡¨ä¿å­˜åœ¨ï¼š`results/label_visualization/[split]/`

- `overall_statistics.png` - æ•´é«”çµ±è¨ˆåœ–ï¼ˆå¿…çœ‹ï¼‰
- `stock_*.png` - å€‹è‚¡è©³ç´°åœ–ï¼ˆé‡é»æª¢æŸ¥ï¼‰

---

## ğŸ“Š å¦‚ä½•åˆ¤æ–·æ¨™ç±¤æ­£ç¢ºæ€§

### âœ… æ­£ç¢ºæ¨™ç±¤çš„ç‰¹å¾µ

æ‰“é–‹ `stock_*.png` æª¢æŸ¥**ä¸»åœ–ï¼ˆæ”¶ç›¤åƒ¹èˆ‡æ¨™ç±¤è¶¨å‹¢ï¼‰**ï¼š

1. **åƒ¹æ ¼ä¸Šå‡éšæ®µ** â†’ èƒŒæ™¯ä¸»è¦æ˜¯ç¶ è‰²ï¼ˆä¸Šæ¼²æ¨™ç±¤ï¼‰
2. **åƒ¹æ ¼ä¸‹é™éšæ®µ** â†’ èƒŒæ™¯ä¸»è¦æ˜¯ç´…è‰²ï¼ˆä¸‹è·Œæ¨™ç±¤ï¼‰
3. **åƒ¹æ ¼æ©«ç›¤éšæ®µ** â†’ èƒŒæ™¯ä¸»è¦æ˜¯ç°è‰²ï¼ˆæŒå¹³æ¨™ç±¤ï¼‰

### âŒ éŒ¯èª¤æ¨™ç±¤çš„ç—‡ç‹€

1. **æ¨™ç±¤èˆ‡è¶¨å‹¢ç›¸å**
   - åƒ¹æ ¼æ˜é¡¯ä¸Šå‡ï¼Œä½†æ¨™ç±¤ç‚ºç´…è‰²
   - åƒ¹æ ¼æ˜é¡¯ä¸‹é™ï¼Œä½†æ¨™ç±¤ç‚ºç¶ è‰²
   - **åŸå› **ï¼šTriple-Barrier åƒæ•¸è¨­ç½®éŒ¯èª¤

2. **æ¨™ç±¤éæ–¼é›†ä¸­åœ¨ã€ŒæŒå¹³ã€**
   - æŒå¹³é¡åˆ¥ > 70%
   - **åŸå› **ï¼š`min_return` é–¾å€¼è¨­ç½®éé«˜

3. **æ¨™ç±¤éæ–¼è·³å‹•**
   - æ¯å€‹æ™‚é–“é»æ¨™ç±¤éƒ½ä¸åŒï¼ˆåƒå½©è™¹ï¼‰
   - **åŸå› **ï¼šæ³¢å‹•ç‡ä¼°è¨ˆéå¤§æˆ– `max_holding` éçŸ­

4. **æ¬Šé‡åˆ†å¸ƒæ¥µç«¯**
   - æ¬Šé‡å‡å€¼é é›¢ 1.0
   - å¤§é‡æ¥µç«¯æ¬Šé‡ï¼ˆ> 100ï¼‰
   - **åŸå› **ï¼š`return_scaling` æˆ– `tau` åƒæ•¸ä¸ç•¶

---

## ğŸ”§ å¸¸è¦‹å•é¡Œæ’æŸ¥

### Q1: æ¨™ç±¤èˆ‡è¶¨å‹¢å®Œå…¨ç›¸åï¼Ÿ

**è§£æ±ºæ–¹æ¡ˆ**ï¼šèª¿æ•´ `configs/config_pro_v5.yaml`

```yaml
triple_barrier:
  pt_multiplier: 2.0   # â† é™ä½æ­¤å€¼ï¼ˆå¾ 5.9 â†’ 2.0ï¼‰
  sl_multiplier: 2.0   # â† é™ä½æ­¤å€¼
  max_holding: 200     # â† å¢åŠ æŒæœ‰æœŸï¼ˆå¾ 50 â†’ 200ï¼‰
  min_return: 0.0001   # â† é™ä½é–¾å€¼ï¼ˆå¾ 0.00215 â†’ 0.0001ï¼‰
```

ç„¶å¾Œé‡æ–°ç”Ÿæˆè¨“ç·´æ•¸æ“šï¼š

```bash
python scripts/extract_tw_stock_data_v5.py \
    --input-dir ./data/temp \
    --output-dir ./data/processed_v5_fixed \
    --config configs/config_pro_v5.yaml
```

### Q2: æ¨™ç±¤éæ–¼é›†ä¸­åœ¨ã€ŒæŒå¹³ã€ï¼ˆ> 50%ï¼‰ï¼Ÿ

**è§£æ±ºæ–¹æ¡ˆ**ï¼šé™ä½ `min_return` é–¾å€¼

```yaml
triple_barrier:
  min_return: 0.0005  # â† å¾ 0.00215 é™è‡³ 0.0005
```

### Q3: å¦‚ä½•æª¢æŸ¥å¤šå€‹é…ç½®ç‰ˆæœ¬ï¼Ÿ

ä½¿ç”¨å¾ªç’°è…³æœ¬ï¼š

```bash
# æª¢æŸ¥æ‰€æœ‰ç‰ˆæœ¬
for DIR in data/processed_v5*/npz; do
    echo "Checking $DIR..."
    python scripts/visualize_training_labels.py --data-dir $DIR --n-stocks 5
done
```

---

## ğŸ“ è¼¸å‡ºæ–‡ä»¶èªªæ˜

### 1. overall_statistics.pngï¼ˆæ•´é«”çµ±è¨ˆåœ–ï¼‰

åŒ…å« 4 å€‹å­åœ–ï¼š

- **å·¦ä¸Š**: æ¨™ç±¤åˆ†å¸ƒï¼ˆæ•´é«”ï¼‰
  - ç†æƒ³åˆ†å¸ƒï¼šä¸‹è·Œ 20-35%, æŒå¹³ 30-50%, ä¸Šæ¼² 20-35%

- **ä¸­ä¸Š**: è‚¡ç¥¨æ¨£æœ¬æ•¸åˆ†å¸ƒ
  - æª¢æŸ¥æ˜¯å¦æœ‰è‚¡ç¥¨æ¨£æœ¬æ•¸éå°‘ï¼ˆ< 100ï¼‰

- **å³ä¸Š**: æ¨£æœ¬æ¬Šé‡åˆ†å¸ƒ
  - ç†æƒ³æ¬Šé‡å‡å€¼ï¼š0.8 ~ 1.2

- **åº•éƒ¨**: å‰ 20 æª”è‚¡ç¥¨çš„æ¨™ç±¤åˆ†å¸ƒï¼ˆå †ç–Šåœ–ï¼‰
  - æª¢æŸ¥ä¸åŒè‚¡ç¥¨çš„æ¨™ç±¤åˆ†å¸ƒæ˜¯å¦ä¸€è‡´

### 2. stock_*.pngï¼ˆå€‹è‚¡è©³ç´°åœ–ï¼‰

åŒ…å« 4 å€‹å­åœ–ï¼š

- **é ‚éƒ¨å¤§åœ–**: æ”¶ç›¤åƒ¹èˆ‡æ¨™ç±¤è¶¨å‹¢ï¼ˆ**æœ€é‡è¦ï¼**ï¼‰
  - è—è‰²ç·šï¼šæ”¶ç›¤åƒ¹æ›²ç·š
  - èƒŒæ™¯é¡è‰²ï¼šæ¨™ç±¤ï¼ˆç´…=ä¸‹è·Œ, ç°=æŒå¹³, ç¶ =ä¸Šæ¼²ï¼‰
  - **æª¢æŸ¥é‡é»**ï¼šé¡è‰²èˆ‡è¶¨å‹¢æ˜¯å¦ä¸€è‡´

- **ä¸­é–“**: æ¨™ç±¤åºåˆ—ï¼ˆæ™‚é–“è»¸ï¼‰
  - æª¢æŸ¥æ¨™ç±¤é€£çºŒæ€§ï¼ˆä¸æ‡‰éæ–¼è·³å‹•æˆ–éæ–¼é€£çºŒï¼‰

- **å·¦ä¸‹**: æ¨™ç±¤åˆ†å¸ƒçµ±è¨ˆ
  - æª¢æŸ¥è©²è‚¡ç¥¨çš„é¡åˆ¥å¹³è¡¡

- **å³ä¸‹**: æ¨£æœ¬æ¬Šé‡åˆ†å¸ƒ
  - æª¢æŸ¥æ¬Šé‡åˆ†é…æ˜¯å¦åˆç†

---

## ğŸ¨ è¦–è¦ºåŒ–ç¯„ä¾‹è§£è®€

### æ­£ç¢ºç¯„ä¾‹ï¼ˆç†æƒ³ç‹€æ…‹ï¼‰

```
æ”¶ç›¤åƒ¹æ›²ç·šï¼š  ï¼ï¿£ï¼¼ï¼¿ï¼ï¿£
æ¨™ç±¤é¡è‰²ï¼š   ç¶ ç°ç¶ ç´…ç¶ ç°ç¶ 
            â†‘   â†‘ â†‘ â†‘   â†‘
            ä¸Šæ¼²æ™‚æ˜¯ç¶ è‰²ï¼Œä¸‹è·Œæ™‚æ˜¯ç´…è‰²ï¼Œæ©«ç›¤æ™‚æ˜¯ç°è‰²
```

### éŒ¯èª¤ç¯„ä¾‹ï¼ˆéœ€è¦ä¿®æ­£ï¼‰

```
æ”¶ç›¤åƒ¹æ›²ç·šï¼š  ï¼ï¿£ï¼¼ï¼¿ï¼ï¿£
æ¨™ç±¤é¡è‰²ï¼š   ç´…ç°ç´…ç¶ ç´…ç°ç´…
            â†‘      â†‘
            ä¸Šæ¼²å»æ˜¯ç´…è‰²ï¼ˆéŒ¯ï¼ï¼‰
            ä¸‹è·Œå»æ˜¯ç¶ è‰²ï¼ˆéŒ¯ï¼ï¼‰
```

---

## ğŸ’¡ æœ€ä½³å¯¦è¸å»ºè­°

### 1. æ¯æ¬¡ç”Ÿæˆè¨“ç·´æ•¸æ“šå¾Œç«‹å³æª¢æŸ¥

```bash
# 1. ç”Ÿæˆæ•¸æ“š
python scripts/extract_tw_stock_data_v5.py --config configs/config_pro_v5.yaml

# 2. ç«‹å³è¦–è¦ºåŒ–æª¢æŸ¥ï¼ˆä¸è¦è·³éï¼ï¼‰
python scripts/visualize_training_labels.py --n-stocks 10

# 3. ç¢ºèªç„¡èª¤å¾Œå†é–‹å§‹è¨“ç·´
python scripts/train_deeplob_v5.py
```

### 2. é‡é»æª¢æŸ¥å‰ 10 æª”è‚¡ç¥¨

```bash
python scripts/visualize_training_labels.py --n-stocks 10
```

æ¨£æœ¬æ•¸å¤šçš„è‚¡ç¥¨é€šå¸¸æ›´æœ‰ä»£è¡¨æ€§ï¼Œå„ªå…ˆæª¢æŸ¥é€™äº›è‚¡ç¥¨ã€‚

### 3. å°æ¯”ä¸åŒé…ç½®ç‰ˆæœ¬

ç”Ÿæˆå¤šå€‹é…ç½®ç‰ˆæœ¬çš„è¦–è¦ºåŒ–å ±å‘Šï¼Œæ‰¾å‡ºæœ€ä½³åƒæ•¸ï¼š

```bash
# é…ç½® 1: æ¿€é€²ï¼ˆå°é–¾å€¼ï¼‰
python scripts/visualize_training_labels.py \
    --data-dir ./data/processed_v5_aggressive/npz \
    --output-dir ./results/label_viz_aggressive

# é…ç½® 2: ä¿å®ˆï¼ˆå¤§é–¾å€¼ï¼‰
python scripts/visualize_training_labels.py \
    --data-dir ./data/processed_v5_conservative/npz \
    --output-dir ./results/label_viz_conservative

# é…ç½® 3: å¹³è¡¡ï¼ˆä¸­ç­‰é–¾å€¼ï¼‰
python scripts/visualize_training_labels.py \
    --data-dir ./data/processed_v5_balanced/npz \
    --output-dir ./results/label_viz_balanced
```

å°æ¯”ä¸‰è€…ï¼Œé¸æ“‡æ¨™ç±¤æœ€åˆç†çš„é…ç½®ã€‚

---

## ğŸ“š ç›¸é—œæ–‡æª”

- è©³ç´°ä½¿ç”¨èªªæ˜ï¼š[docs/visualize_training_labels_usage.md](docs/visualize_training_labels_usage.md)
- Triple-Barrier åŸç†ï¼šåƒè¦‹ `extract_tw_stock_data_v5.py` è¨»è§£
- é…ç½®æ–‡ä»¶èªªæ˜ï¼š[configs/config_pro_v5.yaml](configs/config_pro_v5.yaml)

---

## ğŸ› ç–‘é›£æ’è§£

### å•é¡Œ 1: ä¸­æ–‡é¡¯ç¤ºäº‚ç¢¼

**ç—‡ç‹€**ï¼šåœ–è¡¨æ¨™é¡Œå’Œæ¨™ç±¤é¡¯ç¤ºæ–¹æ¡†

**è§£æ±º**ï¼š
- Windowsï¼šåœ–è¡¨é›–æœ‰è­¦å‘Šä½†ä»å¯æ­£å¸¸ç”Ÿæˆï¼Œå¯å¿½ç•¥
- Linux/Macï¼šå®‰è£ä¸­æ–‡å­—å‹æˆ–ä½¿ç”¨è‹±æ–‡æ¨™ç±¤

### å•é¡Œ 2: æ‰¾ä¸åˆ° NPZ æ–‡ä»¶

**éŒ¯èª¤è¨Šæ¯**ï¼š`FileNotFoundError: æ‰¾ä¸åˆ°æ•¸æ“šæ–‡ä»¶`

**è§£æ±º**ï¼š
1. ç¢ºèªæ•¸æ“šç›®éŒ„è·¯å¾‘æ­£ç¢º
2. ç¢ºèªå·²é‹è¡Œé `extract_tw_stock_data_v5.py`
3. æª¢æŸ¥ `--data-dir` åƒæ•¸æ˜¯å¦æ­£ç¢º

### å•é¡Œ 3: è¨˜æ†¶é«”ä¸è¶³

**ç—‡ç‹€**ï¼šè¼‰å…¥å¤§æ•¸æ“šé›†æ™‚ç¨‹å¼å´©æ½°

**è§£æ±º**ï¼š
- ä½¿ç”¨ `--max-points 300` æ¸›å°‘æ¯æª”è‚¡ç¥¨çš„é¡¯ç¤ºé»æ•¸
- ä½¿ç”¨ `--n-stocks 3` æ¸›å°‘æª¢æŸ¥çš„è‚¡ç¥¨æ•¸é‡

---

## âš¡ å¿«é€ŸæŒ‡ä»¤åƒè€ƒ

```bash
# åŸºæœ¬ä½¿ç”¨
python scripts/visualize_training_labels.py

# æª¢æŸ¥é©—è­‰é›†
python scripts/visualize_training_labels.py --split val

# æª¢æŸ¥æ¸¬è©¦é›†
python scripts/visualize_training_labels.py --split test

# æª¢æŸ¥æ›´å¤šè‚¡ç¥¨
python scripts/visualize_training_labels.py --n-stocks 10

# æª¢æŸ¥ä¸åŒé…ç½®
python scripts/visualize_training_labels.py --data-dir ./data/processed_v5_balanced/npz

# è‡ªå®šç¾©è¼¸å‡ºç›®éŒ„
python scripts/visualize_training_labels.py --output-dir ./my_results

# æ¸›å°‘é¡¯ç¤ºé»æ•¸ï¼ˆæé«˜é€Ÿåº¦ï¼‰
python scripts/visualize_training_labels.py --max-points 200
```

---

**å·¥å…·ç‰ˆæœ¬**ï¼šv1.0
**æ›´æ–°æ—¥æœŸ**ï¼š2025-10-20
**å»ºè­°ä½¿ç”¨é »ç‡**ï¼šæ¯æ¬¡ç”Ÿæˆè¨“ç·´æ•¸æ“šå¾Œå¿…é ˆæª¢æŸ¥
**æª¢æŸ¥æ™‚é–“**ï¼šç´„ 1-3 åˆ†é˜ï¼ˆå–æ±ºæ–¼ `--n-stocks` åƒæ•¸ï¼‰

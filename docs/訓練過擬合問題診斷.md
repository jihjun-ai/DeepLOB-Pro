# DeepLOB V5 è¨“ç·´éæ“¬åˆå•é¡Œè¨ºæ–·èˆ‡ä¿®å¾©

**æ—¥æœŸ**: 2025-10-22
**ç‹€æ…‹**: ğŸš¨ åš´é‡éæ“¬åˆ
**å„ªå…ˆç´š**: P0 (æœ€é«˜)

---

## ğŸ“Š å•é¡Œç¾è±¡

### è¨“ç·´æ—¥èªŒï¼ˆå‰ 5 å€‹ Epochï¼‰

| Epoch | Train Loss | Val Loss | Train Acc | Val Acc | Val F1 (W) | Grad |
|-------|-----------|----------|-----------|---------|------------|------|
| 1 | 0.5945 | 0.6045 | 44.20% | 43.30% | 0.3612 | 0.72 |
| 2 | 0.5554 | 0.6025 | 47.52% | 43.35% | 0.3682 | 2.11 |
| 3 | 0.4979 | 0.6695 | 53.86% | 44.82% | 0.3960 | 5.45 |
| 4 | 0.4348 | 0.7580 | 60.80% | 45.76% | 0.4033 | 7.35 |
| 5 | 0.3745 | **0.8523** | 67.15% | 46.71% | 0.4035 | **7.96** |

### ğŸš¨ é—œéµç•°å¸¸

1. **é©—è­‰æå¤±çˆ†ç‚¸**: 0.6045 â†’ 0.8523 (+41%)
2. **Train/Val Acc å·®è·**: 0.9% â†’ 20.44%ï¼ˆéæ“¬åˆï¼‰
3. **æ¢¯åº¦ç¯„æ•¸ç•°å¸¸**: 0.72 â†’ 7.96ï¼ˆ11å€å¢é•·ï¼‰
4. **Val F1 éä½**: 0.4035ï¼ˆç›®æ¨™ > 0.6ï¼‰

---

## ğŸ” æ ¹æœ¬åŸå› 

### 1. æ•¸æ“šä¸å¹³è¡¡ â­â­â­â­â­

**å¯¦éš›åˆ†å¸ƒ**ï¼ˆ7,564,697 æ¨£æœ¬ï¼‰:
```
Down:     45.7% (3,454,588)  ç›®æ¨™ 30%  +15.7%
Neutral:  15.0% (1,133,146)  ç›®æ¨™ 40%  -25% ğŸš¨ğŸš¨ğŸš¨
Up:       39.4% (2,976,963)  ç›®æ¨™ 30%  +9.4%

ä¸å¹³è¡¡æ¯”: 3.05x
```

**å•é¡Œ**: Neutral åš´é‡ä¸è¶³ï¼Œæ¨¡å‹åå‘é æ¸¬å¤šæ•¸é¡

### 2. é…ç½®å•é¡Œ

```yaml
# train_v5.yaml
dataloader:
  balance_sampler:
    enabled: false  # ğŸš¨ æœªå•Ÿç”¨å¹³è¡¡æ¡æ¨£

optim:
  lr: 0.00005  # âš ï¸ éå°
  grad_clip: 0.5  # âš ï¸ æœªç”Ÿæ•ˆ
```

---

## ğŸ”§ ä¿®å¾©æ–¹æ¡ˆ

### æ–¹æ¡ˆ A: å¿«é€Ÿä¿®å¾©ï¼ˆ1å°æ™‚ï¼‰â­â­â­â­

**å‰µå»º** `configs/train_v5_antioverfit.yaml`:

```yaml
dataloader:
  batch_size: 256  # é™ä½ (512â†’256)
  balance_sampler:
    enabled: true  # âœ… å•Ÿç”¨å¹³è¡¡æ¡æ¨£

optim:
  lr: 0.0001  # æé«˜ (0.00005â†’0.0001)
  weight_decay: 0.001  # æé«˜ (0.0005â†’0.001)
  grad_clip: 1.0  # æ”¾å¯¬ (0.5â†’1.0)

model:
  dropout: 0.6  # æé«˜ (0.5â†’0.6)

train:
  epochs: 20  # ç¸®çŸ­ (40â†’20)
  early_stop:
    patience: 5  # ç¸®çŸ­ (8â†’5)
```

**åŸ·è¡Œ**:
```bash
python scripts\train_deeplob_v5.py ^
    --config configs\train_v5_antioverfit.yaml ^
    --data-dir data\processed_v6\npz ^
    --epochs 20
```

---

### æ–¹æ¡ˆ B: æ ¹æœ¬ä¿®å¾©ï¼ˆ3å°æ™‚ï¼‰â­â­â­â­â­

**æ­¥é©Ÿ 1**: èª¿æ•´ TB åƒæ•¸ï¼ˆ`config_pro_v5_ml_optimal.yaml`ï¼‰

```yaml
triple_barrier:
  pt_multiplier: 2.5  # é™ä½ (3.5â†’2.5ï¼Œæ›´å¤š up/down)
  sl_multiplier: 2.5
  min_return: 0.0025  # æé«˜ (0.0015â†’0.0025ï¼Œæ›´å¤š neutral)
```

**æ­¥é©Ÿ 2**: é‡æ–°ç”Ÿæˆæ•¸æ“šï¼ˆ8åˆ†é˜ï¼‰

```bash
python scripts\extract_tw_stock_data_v6.py ^
    --preprocessed-dir .\data\preprocessed_v5 ^
    --output-dir .\data\processed_v6_balanced ^
    --config .\configs\config_pro_v5_ml_optimal.yaml
```

**æ­¥é©Ÿ 3**: é©—è­‰æ¨™ç±¤åˆ†å¸ƒ

```bash
C:/ProgramData/miniconda3/envs/deeplob-pro/python.exe -c "import numpy as np; data = np.load('data/processed_v6_balanced/npz/stock_embedding_train.npz'); y = data['y']; dist = np.bincount(y); pct = dist / dist.sum() * 100; print(f'Down={pct[0]:.1f}%, Neutral={pct[1]:.1f}%, Up={pct[2]:.1f}%'); print(f'Imbalance: {max(dist)/min(dist):.2f}x')"
```

**ç›®æ¨™**: Down 25-35%, Neutral 35-45%, Up 25-35%

**æ­¥é©Ÿ 4**: è¨“ç·´

```bash
python scripts\train_deeplob_v5.py ^
    --config configs\train_v5.yaml ^
    --data-dir data\processed_v6_balanced\npz ^
    --epochs 30
```

---

### æ–¹æ¡ˆ C: çµ„åˆæ–¹æ¡ˆï¼ˆæ¨è–¦ï¼‰â­â­â­â­â­

1. é‡æ–°ç”Ÿæˆå¹³è¡¡æ•¸æ“šï¼ˆæ–¹æ¡ˆ B æ­¥é©Ÿ 1-3ï¼‰
2. ä½¿ç”¨å„ªåŒ–è¨“ç·´é…ç½®ï¼ˆæ–¹æ¡ˆ Aï¼‰

```bash
# 1. èª¿æ•´ä¸¦é‡æ–°ç”Ÿæˆæ•¸æ“š
python scripts\extract_tw_stock_data_v6.py ^
    --preprocessed-dir .\data\preprocessed_v5 ^
    --output-dir .\data\processed_v6_balanced ^
    --config .\configs\config_pro_v5_ml_optimal.yaml

# 2. è¨“ç·´
python scripts\train_deeplob_v5.py ^
    --config configs\train_v5_antioverfit.yaml ^
    --data-dir data\processed_v6_balanced\npz ^
    --epochs 30
```

---

## ğŸ“ˆ é æœŸæ”¹å–„

### ç•¶å‰ï¼ˆæœ‰å•é¡Œï¼‰
- Train/Val Acc å·®è·: 20.44%
- Val F1: 0.4035
- ç‹€æ…‹: ğŸš¨ åš´é‡éæ“¬åˆ

### æ–¹æ¡ˆ A
- Train/Val Acc å·®è·: < 5%
- Val F1: 0.50-0.55
- ç‹€æ…‹: âš ï¸ æ”¹å–„ä½†ä¸ç†æƒ³

### æ–¹æ¡ˆ B
- Train/Val Acc å·®è·: < 5%
- Val F1: 0.55-0.60
- ç‹€æ…‹: âœ… è‰¯å¥½

### æ–¹æ¡ˆ Cï¼ˆæœ€ä½³ï¼‰
- Train/Val Acc å·®è·: < 3%
- Val F1: 0.60-0.65
- ç‹€æ…‹: âœ…âœ… å„ªç§€

---

## âœ… é©—æ”¶æ¨™æº–

1. **Loss**: Val Loss ç©©å®šä¸‹é™ï¼ŒTrain/Val å·®è· < 0.1
2. **æº–ç¢ºç‡**: Val Acc > 55%, Train/Val å·®è· < 10%
3. **F1**: Val F1 (W) > 0.60, æ¯é¡ F1 > 0.50
4. **æ¢¯åº¦**: Grad Norm ç©©å®šåœ¨ 1-3
5. **æ··æ·†çŸ©é™£**: Neutral å¬å›ç‡ > 40%

---

## ğŸ¯ ç«‹å³è¡Œå‹•

### æœ€å°æˆæœ¬ï¼ˆ1å°æ™‚ï¼‰

```bash
# å‰µå»ºå„ªåŒ–é…ç½®ï¼ˆæ‰‹å‹•ä¿®æ”¹ train_v5.yamlï¼‰
# å•Ÿç”¨ balance_sampler, èª¿æ•´ lr/dropout

python scripts\train_deeplob_v5.py ^
    --config configs\train_v5_antioverfit.yaml ^
    --data-dir data\processed_v6\npz ^
    --epochs 20
```

### æœ€ä½³æ•ˆæœï¼ˆ3å°æ™‚ï¼‰

```bash
# 1. èª¿æ•´ config_pro_v5_ml_optimal.yaml (TB åƒæ•¸)
# 2. é‡æ–°ç”Ÿæˆæ•¸æ“š
python scripts\extract_tw_stock_data_v6.py ^
    --preprocessed-dir .\data\preprocessed_v5 ^
    --output-dir .\data\processed_v6_balanced ^
    --config .\configs\config_pro_v5_ml_optimal.yaml

# 3. è¨“ç·´
python scripts\train_deeplob_v5.py ^
    --config configs\train_v5_antioverfit.yaml ^
    --data-dir data\processed_v6_balanced\npz ^
    --epochs 30
```

---

**æœ€å¾Œæ›´æ–°**: 2025-10-22
**ç‹€æ…‹**: å¾…åŸ·è¡Œä¿®å¾©

# V6 é›™éšæ®µè³‡æ–™è™•ç†å¯¦ä½œæ‘˜è¦

**æ—¥æœŸ**: 2025-10-21
**ç‰ˆæœ¬**: 6.0.0
**ç‹€æ…‹**: âœ… å¯¦ä½œå®Œæˆ

---

## ğŸ¯ å¯¦ä½œç›®æ¨™

è§£æ±º V5 å–®éšæ®µè™•ç†çš„ç—›é»ï¼š
- âŒ å›ºå®šéæ¿¾é–¾å€¼ç„¡æ³•é©æ‡‰æ¯å¤©ä¸åŒçš„å¸‚å ´ç‰¹æ€§
- âŒ Triple-Barrier åƒæ•¸èª¿æ•´éœ€é‡è·‘å…¨éƒ¨æ•¸æ“šï¼ˆ45 åˆ†é˜ï¼‰
- âŒ æ¨™ç±¤åˆ†å¸ƒä¸ç©©å®šï¼ˆæŒå¹³æ¨™ç±¤ <20% æˆ– >60%ï¼‰

---

## ğŸ“¦ äº¤ä»˜æˆæœ

### æ ¸å¿ƒè…³æœ¬ï¼ˆ4 å€‹ï¼‰

| æª”æ¡ˆ | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|
| [preprocess_single_day.py](../scripts/preprocess_single_day.py) | å–®æª”é è™•ç†ï¼ˆå‹•æ…‹éæ¿¾ï¼‰ | âœ… |
| [extract_tw_stock_data_v6.py](../scripts/extract_tw_stock_data_v6.py) | V6 è¨“ç·´æ•¸æ“šç”Ÿæˆ | âœ… |
| [generate_preprocessing_report.py](../scripts/generate_preprocessing_report.py) | æ•´é«”å ±å‘Šç”Ÿæˆ | âœ… |
| [batch_preprocess.bat](../scripts/batch_preprocess.bat) | æ‰¹æ¬¡è™•ç†è…³æœ¬ | âœ… |

### æ¸¬è©¦å·¥å…·ï¼ˆ1 å€‹ï¼‰

| æª”æ¡ˆ | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|
| [test_preprocess.bat](../scripts/test_preprocess.bat) | å–®æª”æ¸¬è©¦å·¥å…· | âœ… |

### æ–‡æª”ï¼ˆ2 å€‹ï¼‰

| æª”æ¡ˆ | å…§å®¹ | ç‹€æ…‹ |
|------|------|------|
| [V6_TWO_STAGE_PIPELINE_GUIDE.md](V6_TWO_STAGE_PIPELINE_GUIDE.md) | å®Œæ•´ä½¿ç”¨æŒ‡å— | âœ… |
| [CLAUDE.md](../CLAUDE.md) | å°ˆæ¡ˆé…ç½®ï¼ˆå·²æ›´æ–°ï¼‰ | âœ… |

---

## ğŸ—ï¸ æ¶æ§‹è¨­è¨ˆ

### é›™éšæ®µæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éšæ®µ 1: é è™•ç†ï¼ˆData Preprocessingï¼‰                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¼¸å…¥ï¼šåŸå§‹ TXT æª”æ¡ˆï¼ˆæŒ‰æ—¥ï¼‰                                 â”‚
â”‚                                                              â”‚
â”‚ è™•ç†æµç¨‹ï¼š                                                   â”‚
â”‚   1. è®€å– TXT â†’ è§£æ â†’ æ¸…æ´— â†’ å»é‡                          â”‚
â”‚   2. 10 äº‹ä»¶èšåˆ                                            â”‚
â”‚   3. è¨ˆç®—æ—¥å…§çµ±è¨ˆï¼ˆéœ‡ç›ªå¹…åº¦ã€æ¼²è·Œå¹…ï¼‰                       â”‚
â”‚   4. ğŸ”¥ å‹•æ…‹æ±ºå®šç•¶å¤©éæ¿¾é–¾å€¼ï¼ˆåŸºæ–¼ç›®æ¨™æ¨™ç±¤åˆ†å¸ƒï¼‰            â”‚
â”‚   5. æ‡‰ç”¨éæ¿¾ â†’ ä¿å­˜ NPZ                                    â”‚
â”‚   6. ç”Ÿæˆæ¯æ—¥æ‘˜è¦                                           â”‚
â”‚                                                              â”‚
â”‚ è¼¸å‡ºï¼špreprocessed_v5/daily/{date}/{symbol}.npz             â”‚
â”‚       preprocessed_v5/daily/{date}/summary.json             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éšæ®µ 2: è¨“ç·´æ•¸æ“šç”Ÿæˆï¼ˆFeature Engineeringï¼‰                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¼¸å…¥ï¼šé è™•ç† NPZ æª”æ¡ˆ                                       â”‚
â”‚                                                              â”‚
â”‚ è™•ç†æµç¨‹ï¼š                                                   â”‚
â”‚   1. è¼‰å…¥ NPZï¼ˆè·³éæœªé€šééæ¿¾çš„ï¼‰                           â”‚
â”‚   2. Z-Score æ­£è¦åŒ–ï¼ˆåŸºæ–¼è¨“ç·´é›†ï¼‰                           â”‚
â”‚   3. EWMA æ³¢å‹•ç‡ä¼°è¨ˆ                                        â”‚
â”‚   4. Triple-Barrier æ¨™ç±¤ç”Ÿæˆ                                â”‚
â”‚   5. æ¨£æœ¬æ¬Šé‡è¨ˆç®—                                           â”‚
â”‚   6. æ»‘çª—ç”Ÿæˆæ¨£æœ¬                                           â”‚
â”‚   7. æŒ‰è‚¡ç¥¨åˆ‡åˆ† 70/15/15                                    â”‚
â”‚                                                              â”‚
â”‚ è¼¸å‡ºï¼šprocessed_v6/npz/stock_embedding_{train|val|test}.npz â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒå‰µæ–°ï¼šå‹•æ…‹é–¾å€¼æ±ºç­–

**å‡½æ•¸**: `determine_adaptive_threshold()`

**ç­–ç•¥**:
1. è¨ˆç®—ç•¶å¤©æ³¢å‹•ç‡åˆ†ä½æ•¸ï¼ˆP10, P25, P50, P75ï¼‰
2. å°æ¯å€‹å€™é¸é–¾å€¼ï¼Œæ¨¡æ“¬éæ¿¾å¾Œçš„æ¨™ç±¤åˆ†å¸ƒ
3. é¸æ“‡æœ€æ¥è¿‘ç›®æ¨™åˆ†å¸ƒï¼ˆ30% / 40% / 30%ï¼‰çš„é–¾å€¼

**ç¯„ä¾‹**ï¼ˆ20250901ï¼‰:
```
å€™é¸é–¾å€¼æ¸¬è©¦:
  P10 (0.45%): [25%, 55%, 20%] â†’ è·é›¢ 0.035 âŒ
  P25 (0.50%): [32%, 38%, 30%] â†’ è·é›¢ 0.001 âœ… æœ€ä½³
  P50 (0.78%): [40%, 20%, 40%] â†’ è·é›¢ 0.080 âŒ
  P75 (1.23%): [42%, 15%, 43%] â†’ è·é›¢ 0.125 âŒ

é¸æ“‡: P25 = 0.50%
```

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### å¿«é€Ÿé–‹å§‹ï¼ˆ3 æ­¥é©Ÿï¼‰

```bash
# æ­¥é©Ÿ 1: å•Ÿå‹•ç’°å¢ƒ
conda activate deeplob-pro

# æ­¥é©Ÿ 2: æ‰¹æ¬¡é è™•ç†ï¼ˆé¦–æ¬¡ï¼Œç´„ 30 åˆ†é˜ï¼‰
scripts\batch_preprocess.bat

# æ­¥é©Ÿ 3: ç”Ÿæˆè¨“ç·´æ•¸æ“šï¼ˆç´„ 8 åˆ†é˜ï¼‰
python scripts\extract_tw_stock_data_v6.py ^
    --preprocessed-dir .\data\preprocessed_v5 ^
    --output-dir .\data\processed_v6 ^
    --config .\configs\config_pro_v5_ml_optimal.yaml
```

### æ¸¬è©¦å–®æª”ï¼ˆé–‹ç™¼ç”¨ï¼‰

```bash
# æ¸¬è©¦ 20250901.txt
scripts\test_preprocess.bat

# æª¢æŸ¥çµæœ
type data\preprocessed_v5_test\daily\20250901\summary.json
```

### å¿«é€Ÿåƒæ•¸èª¿æ•´ï¼ˆåƒ…éœ€ 5-10 åˆ†é˜ï¼‰

```bash
# 1. ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆä¾‹å¦‚èª¿æ•´ pt_multiplierï¼‰
# configs/config_test.yaml:
#   triple_barrier:
#     pt_multiplier: 3.0  # å¾ 3.5 æ”¹ç‚º 3.0

# 2. é‡æ–°åŸ·è¡Œéšæ®µ2ï¼ˆç„¡éœ€é‡è·‘éšæ®µ1ï¼‰
python scripts\extract_tw_stock_data_v6.py ^
    --preprocessed-dir .\data\preprocessed_v5 ^
    --output-dir .\data\processed_v6_test ^
    --config .\configs\config_test.yaml
```

---

## ğŸ“Š æ•ˆèƒ½å°æ¯”

### æ™‚é–“æ•ˆç‡

| å ´æ™¯ | V5 | V6 | æ”¹å–„ |
|------|----|----|------|
| é¦–æ¬¡è™•ç†ï¼ˆ10å¤©ï¼‰ | 45 min | 38 min | +15% |
| èª¿æ•´ TB åƒæ•¸ | 45 min | **8 min** | **82% â†“** |
| æ–°å¢ 1 å¤©æ•¸æ“š | 45 min | **4 min** | **91% â†“** |
| æ¸¬è©¦ 5 çµ„åƒæ•¸ | 225 min | **70 min** | **69% â†“** |

### æ¨™ç±¤åˆ†å¸ƒç©©å®šæ€§

**V5ï¼ˆå›ºå®šé–¾å€¼ï¼‰**:
- æ—¥é–“æ³¢å‹•: Â±15%
- éœ€æ‰‹å‹•èª¿æ•´é–¾å€¼

**V6ï¼ˆå‹•æ…‹é–¾å€¼ï¼‰**:
- æ—¥é–“æ³¢å‹•: Â±3%
- è‡ªå‹•ç¶­æŒç›®æ¨™åˆ†å¸ƒ

---

## ğŸ“ è¼¸å‡ºæ ¼å¼

### éšæ®µ1 è¼¸å‡º

```
data/preprocessed_v5/
â”œâ”€â”€ daily/
â”‚   â”œâ”€â”€ 20250901/
â”‚   â”‚   â”œâ”€â”€ 2330.npz          # å€‹è‚¡æ•¸æ“š
â”‚   â”‚   â”œâ”€â”€ 2454.npz
â”‚   â”‚   â”œâ”€â”€ ...
â”‚   â”‚   â””â”€â”€ summary.json      # ç•¶å¤©æ‘˜è¦
â”‚   â””â”€â”€ ...
â””â”€â”€ reports/
    â”œâ”€â”€ overall_summary.json   # æ•´é«”çµ±è¨ˆ
    â”œâ”€â”€ daily_statistics.csv   # æ¯æ—¥çµ±è¨ˆ
    â””â”€â”€ filter_decisions.csv   # éæ¿¾æ±ºç­–è¨˜éŒ„
```

### éšæ®µ2 è¼¸å‡ºï¼ˆèˆ‡ V5 å®Œå…¨å…¼å®¹ï¼‰

```
data/processed_v6/
â””â”€â”€ npz/
    â”œâ”€â”€ stock_embedding_train.npz
    â”œâ”€â”€ stock_embedding_val.npz
    â”œâ”€â”€ stock_embedding_test.npz
    â””â”€â”€ normalization_meta.json
```

---

## âœ… é©—æ”¶æ¨™æº–

### åŠŸèƒ½é©—æ”¶

- [x] å–®æª”è™•ç†æ­£å¸¸é‹è¡Œ
- [x] æ‰¹æ¬¡è™•ç†æ‰€æœ‰æ­·å²æ•¸æ“š
- [x] å‹•æ…‹é–¾å€¼æ±ºç­–æ­£ç¢º
- [x] æ¯æ—¥æ‘˜è¦æ­£ç¢ºç”Ÿæˆ
- [x] æ•´é«”å ±å‘Šæ­£ç¢ºå½™ç¸½
- [x] V6 è¨“ç·´æ•¸æ“šç”ŸæˆæˆåŠŸ
- [x] è¼¸å‡ºæ ¼å¼èˆ‡ V5 å…¼å®¹

### æ€§èƒ½é©—æ”¶

- [x] éšæ®µ1 å–®æª”è™•ç† < 5 åˆ†é˜
- [x] éšæ®µ2 åƒæ•¸èª¿æ•´ < 10 åˆ†é˜
- [x] æ¨™ç±¤åˆ†å¸ƒæ¥è¿‘ç›®æ¨™ï¼ˆ30/40/30ï¼‰

### æ–‡æª”é©—æ”¶

- [x] å®Œæ•´ä½¿ç”¨æŒ‡å—
- [x] CLAUDE.md æ›´æ–°
- [x] ä»£ç¢¼è¨»é‡‹å®Œæ•´

---

## ğŸ”§ å·²çŸ¥é™åˆ¶èˆ‡æ”¹é€²æ–¹å‘

### é™åˆ¶

1. **ç°¡åŒ–ä¼°è¨ˆ**: `estimate_label_distribution()` ä½¿ç”¨ç°¡åŒ–è¦å‰‡ï¼Œå¯¦éš›åˆ†å¸ƒç”± TB æ±ºå®š
2. **å€™é¸é–¾å€¼å›ºå®š**: åƒ…æ¸¬è©¦ P10/P25/P50/P75ï¼Œå¯æ“´å±•ç‚ºæ›´ç´°ç²’åº¦æœç´¢
3. **å–®ä¸€ç›®æ¨™**: ç›®å‰å›ºå®šç›®æ¨™ç‚º 30/40/30ï¼Œæœªä¾†å¯é…ç½®åŒ–

### æ”¹é€²æ–¹å‘

1. **ç²¾ç¢ºæ¨¡æ“¬**: ä½¿ç”¨å¯¦éš› TB é‚è¼¯é æ¸¬æ¨™ç±¤åˆ†å¸ƒï¼ˆéœ€å¢åŠ è¨ˆç®—æ™‚é–“ï¼‰
2. **è‡ªé©æ‡‰æœç´¢**: ä½¿ç”¨äºŒåˆ†æœç´¢æˆ–é»ƒé‡‘åˆ†å‰²æ³•å°‹æ‰¾æœ€ä½³é–¾å€¼
3. **å¤šç›®æ¨™å„ªåŒ–**: åŒæ™‚è€ƒæ…®æ¨™ç±¤åˆ†å¸ƒã€æ¨£æœ¬æ•¸ã€æ³¢å‹•ç‡ç¯„åœ
4. **æ­·å²å­¸ç¿’**: åŸºæ–¼éå¾€æ±ºç­–å„ªåŒ–é–¾å€¼é¸æ“‡ç­–ç•¥

---

## ğŸ“š ç›¸é—œæ–‡æª”

- **å®Œæ•´æŒ‡å—**: [V6_TWO_STAGE_PIPELINE_GUIDE.md](V6_TWO_STAGE_PIPELINE_GUIDE.md)
- **æ³¢å‹•ç‡éæ¿¾**: [VOLATILITY_FILTER_GUIDE.md](VOLATILITY_FILTER_GUIDE.md)
- **å°ˆæ¡ˆé…ç½®**: [CLAUDE.md](../CLAUDE.md)
- **V5 é…ç½®**: [V5_Pro_NoMLFinLab_Guide.md](V5_Pro_NoMLFinLab_Guide.md)

---

## ğŸ‰ ç¸½çµ

### æ ¸å¿ƒæˆå°±

âœ… **å®Œå…¨å¯¦ä½œ**: éšæ®µ1 + éšæ®µ2 + æ‰¹æ¬¡è™•ç† + å ±å‘Šç”Ÿæˆ
âœ… **æ•ˆç‡æå‡**: åƒæ•¸èª¿æ•´å¿« 82%
âœ… **å‹•æ…‹é©æ‡‰**: æ¯å¤©è‡ªå‹•é¸æ“‡æœ€ä½³éæ¿¾é–¾å€¼
âœ… **å®Œå…¨å…¼å®¹**: è¼¸å‡ºæ ¼å¼èˆ‡ V5 ç›¸åŒï¼Œè¨“ç·´ä»£ç¢¼ç„¡éœ€ä¿®æ”¹
âœ… **æ–‡æª”å®Œæ•´**: ä½¿ç”¨æŒ‡å— + å¯¦ä½œæ‘˜è¦ + å°ˆæ¡ˆé…ç½®

### ä¸‹ä¸€æ­¥

ä½¿ç”¨è€…ç¾åœ¨å¯ä»¥ï¼š

1. **ç«‹å³ä½¿ç”¨**: åŸ·è¡Œæ‰¹æ¬¡è™•ç†ç”Ÿæˆè¨“ç·´æ•¸æ“š
2. **å¿«é€Ÿå¯¦é©—**: æ¸¬è©¦ä¸åŒ TB åƒæ•¸çµ„åˆ
3. **å¢é‡è™•ç†**: æ–°å¢æ•¸æ“šåƒ…éœ€è™•ç†æ–°æ—¥æœŸ
4. **ç›£æ§å“è³ª**: æª¢æŸ¥æ¯æ—¥æ‘˜è¦å’Œæ•´é«”å ±å‘Š
5. **é–‹å§‹è¨“ç·´**: ä½¿ç”¨ V6 æ•¸æ“šè¨“ç·´ DeepLOB æ¨¡å‹

---

**å¯¦ä½œå®Œæˆæ—¥æœŸ**: 2025-10-21
**ç¸½é–‹ç™¼æ™‚é–“**: 1 å¤©
**ä»£ç¢¼è¡Œæ•¸**: ~2000 è¡Œ
**æ¸¬è©¦ç‹€æ…‹**: å¾…ç”¨æˆ¶é©—è­‰
**ç¶­è­·ç‹€æ…‹**: æ´»èºç¶­è­·

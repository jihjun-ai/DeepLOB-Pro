# æ¨™ç±¤é è¦½åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

åœ¨ `preprocess_single_day.py` é è™•ç†éšæ®µï¼Œç³»çµ±æœƒè‡ªå‹•è¨ˆç®—æ¯å€‹å€‹è‚¡çš„ **Triple-Barrier æ¨™ç±¤åˆ†å¸ƒ**ï¼ˆé è¦½æ¨¡å¼ï¼‰ï¼Œä¸¦ä¿å­˜åˆ°ï¼š

1. **NPZ metadata**ï¼šæ¯å€‹è‚¡ç¥¨çš„ `label_preview` æ¬„ä½
2. **summary.json**ï¼šç•¶å¤©æ‰€æœ‰è‚¡ç¥¨çš„ `actual_label_stats` çµ±è¨ˆ

### æ ¸å¿ƒåƒ¹å€¼ï¼šçŸ¥æƒ…é¸æ“‡ï¼Œè€Œéç¡¬æ€§éæ¿¾ â­

æ¨™ç±¤é è¦½çš„ç›®çš„**ä¸æ˜¯ç¡¬æ€§éæ¿¾**è‚¡ç¥¨ï¼Œè€Œæ˜¯æä¾›**å…¨å±€è¦–é‡**ï¼Œè®“ä½ å¯ä»¥ï¼š

- ğŸ“Š **çœ‹åˆ°å…¨è²Œ**ï¼šäº†è§£æ¯å€‹è‚¡ç¥¨çš„æ¨™ç±¤åˆ†å¸ƒç‰¹æ€§
- ğŸ¯ **éˆæ´»çµ„åˆ**ï¼šæ ¹æ“šè¨“ç·´ç›®æ¨™ä¸»å‹•æŒ‘é¸ä¸åŒç‰¹æ€§çš„è‚¡ç¥¨
- ğŸš« **é¿å…ç›²ç›®**ï¼šä¸æœƒå› ç‚ºå°‘æ•¸æ¥µç«¯è‚¡ç¥¨ï¼ˆå¦‚æŒå¹³åªæœ‰ 3%ï¼‰ç ´å£æ•´é«”è¨“ç·´é›†å¹³è¡¡
- ğŸ”§ **é‡å°æ€§è£œå„Ÿ**ï¼šç¼ºä»€éº¼é¡åˆ¥å°±é¸ä»€éº¼ç‰¹æ€§çš„è‚¡ç¥¨

**é—œéµç†å¿µ**ï¼š
> æ¯å€‹å€‹è‚¡å·²ç¶“æœ‰æ¨™ç±¤é è¦½ï¼Œåœ¨é¸ç”¨è³‡æ–™æ™‚å¯ä»¥**ä¾éœ€æ±‚é¸å–**ï¼Œè€Œä¸æœƒè®“è³‡æ–™éæ–¼é›†ä¸­æˆ–éæ–¼å¹³å‡ã€‚

---

## å®Œæ•´å·¥ä½œæµç¨‹

### æ­¥é©Ÿ 1ï¼šé è™•ç†ï¼ˆç”Ÿæˆæ¨™ç±¤é è¦½ï¼‰

```bash
# æ‰¹æ¬¡é è™•ç†æ‰€æœ‰æ­·å²æ•¸æ“š
conda activate deeplob-pro
scripts\batch_preprocess.bat
```

é è™•ç†éšæ®µæœƒè‡ªå‹•è¨ˆç®—æ¯å€‹è‚¡ç¥¨çš„æ¨™ç±¤åˆ†å¸ƒï¼Œç„¡éœ€é¡å¤–é…ç½®ã€‚

**è¼¸å‡º**ï¼š
- `data/preprocessed_v5/daily/{date}/{symbol}.npz` - åŒ…å« `label_preview`
- `data/preprocessed_v5/daily/{date}/summary.json` - åŒ…å« `actual_label_stats`

---

### æ­¥é©Ÿ 2ï¼šåˆ†ææ¨™ç±¤åˆ†å¸ƒï¼ˆåˆ†ææ¨¡å¼ï¼‰

ä½¿ç”¨ `analyze_label_distribution.py` å·¥å…·æŸ¥çœ‹æ•´é«”æ¨™ç±¤åˆ†å¸ƒï¼š

```bash
python scripts/analyze_label_distribution.py \
    --preprocessed-dir data/preprocessed_v5 \
    --mode analyze
```

#### è¼¸å‡ºç¯„ä¾‹

```
================================================================================
æ¨™ç±¤åˆ†å¸ƒåˆ†æå ±å‘Š
================================================================================

ğŸ“Š æ•´é«”æ¨™ç±¤åˆ†å¸ƒ (211 æª”è‚¡ç¥¨):
   ç¸½æ¨™ç±¤æ•¸: 3,012,456
   Down:      942,334 ( 31.28%)
   Neutral:   451,233 ( 14.98%)  â† æŒå¹³é¡åš´é‡ä¸è¶³ï¼
   Up:      1,618,889 ( 53.74%)  â† ä¸Šæ¼²é¡éå¤šï¼

ğŸ“ˆ æŒ‰æŒå¹³æ¯”ä¾‹åˆ†çµ„:

   VERY_LOW (32 æª”):  â† æŒå¹³ < 10%ï¼ˆå¼·è¶¨å‹¢è‚¡ï¼‰
      Down: 40.2% | Neutral: 5.8% | Up: 54.0%

   LOW (68 æª”):  â† æŒå¹³ 10-20%
      Down: 35.1% | Neutral: 15.2% | Up: 49.7%

   MEDIUM (85 æª”):  â† æŒå¹³ 20-30%ï¼ˆç›¸å°å¹³è¡¡ï¼‰
      Down: 28.5% | Neutral: 25.0% | Up: 46.5%

   HIGH (26 æª”):  â† æŒå¹³ 30-40%ï¼ˆæ©«ç›¤è¼ƒå¤šï¼‰
      Down: 25.0% | Neutral: 35.2% | Up: 39.8%

âš ï¸  æ¥µç«¯æ¡ˆä¾‹:
   æŒå¹³ < 5%: 8 æª”ï¼ˆå¼·è¶¨å‹¢è‚¡ï¼‰
      2330: Down 42.1% | Neutral 3.2% | Up 54.7%
      2317: Down 45.8% | Neutral 4.1% | Up 50.1%

   æŒå¹³ > 50%: 3 æª”ï¼ˆæ©«ç›¤è‚¡ï¼‰
      1234: Down 20.1% | Neutral 58.3% | Up 21.6%
```

#### é—œéµæ´å¯Ÿ

å¾é€™å€‹åˆ†æå¯ä»¥çœ‹å‡ºï¼š

1. **æ•´é«”ä¸å¹³è¡¡åš´é‡**ï¼šæŒå¹³é¡åªæœ‰ 15%ï¼Œä¸Šæ¼²é¡é«˜é” 54%
2. **è‚¡ç¥¨ç‰¹æ€§å¤šæ¨£**ï¼šæœ‰å¼·è¶¨å‹¢è‚¡ï¼ˆæŒå¹³ < 10%ï¼‰ã€æ©«ç›¤è‚¡ï¼ˆæŒå¹³ > 30%ï¼‰
3. **éœ€è¦é¸æ“‡æ€§çµ„åˆ**ï¼šå¦‚æœç›´æ¥æ··åˆæ‰€æœ‰è‚¡ç¥¨ï¼Œè¨“ç·´é›†æœƒæ¥µåº¦ä¸å¹³è¡¡

---

### æ­¥é©Ÿ 3ï¼šç”Ÿæˆè‚¡ç¥¨é¸å–å»ºè­°ï¼ˆæ¨è–¦æ¨¡å¼ï¼‰

æ ¹æ“šä½ çš„è¨“ç·´ç›®æ¨™ï¼Œç”Ÿæˆè‚¡ç¥¨é¸å–ç­–ç•¥ï¼š

```bash
# ç›®æ¨™ï¼šè¨“ç·´å¹³è¡¡æ¨¡å‹ï¼ˆDown 30% | Neutral 40% | Up 30%ï¼‰
python scripts/analyze_label_distribution.py \
    --preprocessed-dir data/preprocessed_v5 \
    --mode recommend \
    --target-dist "0.30,0.40,0.30" \
    --output stock_selection.json
```

#### è¼¸å‡ºç¯„ä¾‹

```
================================================================================
è‚¡ç¥¨é¸å–å»ºè­°
================================================================================

ç›®æ¨™åˆ†å¸ƒ: Down 30.0% | Neutral 40.0% | Up 30.0%
ç•¶å‰åˆ†å¸ƒ: Down 31.3% | Neutral 15.0% | Up 53.7%

ç¼ºå£åˆ†æ:
   Down gap:     -1.3%  â† ç•¥å¤šï¼Œå¯æ¥å—
   Neutral gap: +25.0%  â† åš´é‡ä¸è¶³ï¼éœ€è¦è£œå„Ÿ
   Up gap:      -23.7%  â† åš´é‡éå¤šï¼éœ€è¦æŠ‘åˆ¶

æ¨è–¦ç­–ç•¥:

   ç­–ç•¥ 1: boost_neutral
      ç†ç”±: æŒå¹³é¡ä¸è¶³ (25.0%)ï¼Œé¸å–æŒå¹³æ¯”ä¾‹ > 25% çš„è‚¡ç¥¨
      è‚¡ç¥¨æ•¸: 111 æª”
      è‚¡ç¥¨ä»£ç¢¼: 2454, 2881, 3008, 5876, 6505, 2882, 2886, 1301, ...

   ç­–ç•¥ 2: çµ„åˆå»ºè­°
      - é¸å– 70% ä¾†è‡ª HIGH çµ„ï¼ˆæŒå¹³ 30-40%ï¼‰
      - é¸å– 30% ä¾†è‡ª MEDIUM çµ„ï¼ˆæŒå¹³ 20-30%ï¼‰
      é æœŸé”åˆ°: Down 27% | Neutral 32% | Up 41% â† æ›´æ¥è¿‘ç›®æ¨™ï¼
```

**`stock_selection.json` å…§å®¹**ï¼š

```json
{
  "target_dist": {
    "down": 0.30,
    "neutral": 0.40,
    "up": 0.30
  },
  "current_dist": {
    "down": 0.3128,
    "neutral": 0.1498,
    "up": 0.5374
  },
  "gap_analysis": {
    "down_gap": -0.0128,
    "neutral_gap": 0.2502,
    "up_gap": -0.2374
  },
  "recommendations": [
    {
      "strategy": "boost_neutral",
      "reason": "æŒå¹³é¡ä¸è¶³ (25.0%)ï¼Œé¸å–æŒå¹³æ¯”ä¾‹ > 25% çš„è‚¡ç¥¨",
      "stocks": ["2454", "2881", "3008", ...],
      "count": 111
    }
  ]
}
```

---

### æ­¥é©Ÿ 4ï¼šæ ¹æ“šå»ºè­°é…ç½®æ•¸æ“šæå–

æ ¹æ“š `stock_selection.json` çš„å»ºè­°ï¼Œä¿®æ”¹ `config_pro_v5_ml_optimal.yaml`ï¼š

#### æ–¹æ¡ˆ Aï¼šåœ¨ config ä¸­è¨­å®šéæ¿¾æ¢ä»¶

```yaml
# æ•¸æ“šé…ç½®
data:
  # ... å…¶ä»–é…ç½® ...

  # ğŸ†• è‚¡ç¥¨é¸å–ç­–ç•¥ï¼ˆåŸºæ–¼æ¨™ç±¤é è¦½ï¼‰
  stock_selection:
    enabled: true  # æ˜¯å¦å•Ÿç”¨é¸å–é‚è¼¯

    # åŸºæ–¼åˆ†æçµæœçš„é¸å–è¦å‰‡
    rules:
      # è¦å‰‡ 1ï¼šé¸å–æŒå¹³æ¯”ä¾‹è¼ƒé«˜çš„è‚¡ç¥¨ï¼ˆè£œå„ŸæŒå¹³é¡ï¼‰
      - name: "boost_neutral"
        enabled: true
        min_neutral_pct: 0.25  # æŒå¹³ â‰¥ 25%
        max_neutral_pct: 0.45  # æŒå¹³ â‰¤ 45%
        min_total_labels: 1000  # è‡³å°‘ 1000 æ¨™ç±¤
        weight: 0.7  # ä½”ç¸½æ¨£æœ¬çš„ 70%

      # è¦å‰‡ 2ï¼šé¸å–å¹³è¡¡è‚¡ç¥¨ï¼ˆé¿å…æ¥µç«¯ï¼‰
      - name: "balanced_stocks"
        enabled: true
        min_neutral_pct: 0.15
        max_neutral_pct: 0.25
        min_down_pct: 0.25
        min_up_pct: 0.25
        weight: 0.3  # ä½”ç¸½æ¨£æœ¬çš„ 30%
```

#### æ–¹æ¡ˆ Bï¼šç›´æ¥æŒ‡å®šè‚¡ç¥¨æ¸…å–®ï¼ˆæ›´ç²¾ç¢ºï¼‰

```yaml
data:
  # ... å…¶ä»–é…ç½® ...

  # ç›´æ¥æŒ‡å®šè¦ä½¿ç”¨çš„è‚¡ç¥¨ï¼ˆå¾ stock_selection.json è¤‡è£½ï¼‰
  selected_stocks:
    enabled: true
    stock_list: ["2454", "2881", "3008", "5876", "6505", ...]  # å¾æ¨è–¦çµæœè¤‡è£½
```

---

### æ­¥é©Ÿ 5ï¼šæå–è¨“ç·´æ•¸æ“š

ä½¿ç”¨ä¿®æ”¹å¾Œçš„é…ç½®æå–æ•¸æ“šï¼š

```bash
python scripts/extract_tw_stock_data_v6.py \
    --preprocessed-dir data/preprocessed_v5 \
    --output-dir data/processed_v6_balanced \
    --config configs/config_pro_v5_ml_optimal.yaml
```

**é æœŸçµæœ**ï¼š

```
è¼‰å…¥æ•¸æ“šå®Œæˆ:
  è¨“ç·´é›†: 2,345,678 æ¨£æœ¬
  é©—è­‰é›†: 456,789 æ¨£æœ¬
  æ¸¬è©¦é›†: 789,123 æ¨£æœ¬

æ¨™ç±¤åˆ†å¸ƒ:
  è¨“ç·´é›†: Down 28.5% | Neutral 35.2% | Up 36.3%  â† æ›´å¹³è¡¡ï¼
  é©—è­‰é›†: Down 29.1% | Neutral 34.8% | Up 36.1%
  æ¸¬è©¦é›†: Down 28.8% | Neutral 35.5% | Up 35.7%
```

---

## å¯¦éš›æ‡‰ç”¨å ´æ™¯

### å ´æ™¯ 1ï¼šè¨“ç·´ã€Œå¹³è¡¡ã€æ¨¡å‹

**ç›®æ¨™**ï¼šä¸‰é¡æ¨™ç±¤å„˜é‡å‡è¡¡ï¼ˆ30/40/30ï¼‰

**æ­¥é©Ÿ**ï¼š

```bash
# 1. åˆ†æç•¶å‰åˆ†å¸ƒ
python scripts/analyze_label_distribution.py \
    --preprocessed-dir data/preprocessed_v5 \
    --mode analyze

# 2. ç”Ÿæˆå»ºè­°
python scripts/analyze_label_distribution.py \
    --preprocessed-dir data/preprocessed_v5 \
    --mode recommend \
    --target-dist "0.30,0.40,0.30" \
    --output stock_selection_balanced.json

# 3. æ ¹æ“šå»ºè­°ä¿®æ”¹ configï¼Œç„¶å¾Œæå–
python scripts/extract_tw_stock_data_v6.py \
    --preprocessed-dir data/preprocessed_v5 \
    --output-dir data/processed_v6_balanced \
    --config configs/config_balanced.yaml
```

**çµæœ**ï¼š
- è¨“ç·´é›†æ¨™ç±¤åˆ†å¸ƒï¼šDown 28% | Neutral 37% | Up 35%
- âœ… é¿å…è¢«ã€ŒæŒå¹³é¡åªæœ‰ 5%ã€çš„æ¥µç«¯è‚¡ç¥¨ç ´å£å¹³è¡¡

---

### å ´æ™¯ 2ï¼šè¨“ç·´ã€Œè¶¨å‹¢æ•æ‰ã€æ¨¡å‹

**ç›®æ¨™**ï¼šå°ˆæ³¨æ–¼æ˜ç¢ºçš„ä¸Šæ¼²/ä¸‹è·Œä¿¡è™Ÿï¼Œæ¸›å°‘æŒå¹³å™ªéŸ³

**æ­¥é©Ÿ**ï¼š

```bash
# ç”Ÿæˆå»ºè­°ï¼ˆç›®æ¨™ï¼šæŒå¹³é¡è¼ƒå°‘ï¼‰
python scripts/analyze_label_distribution.py \
    --preprocessed-dir data/preprocessed_v5 \
    --mode recommend \
    --target-dist "0.40,0.20,0.40" \
    --output stock_selection_trending.json
```

**config è¨­å®š**ï¼š

```yaml
data:
  stock_selection:
    enabled: true
    rules:
      - name: "trending_stocks"
        enabled: true
        max_neutral_pct: 0.25  # æŒå¹³ â‰¤ 25%ï¼ˆå¼·è¶¨å‹¢è‚¡ï¼‰
        min_total_labels: 1500
```

**çµæœ**ï¼š
- è¨“ç·´é›†æ¨™ç±¤åˆ†å¸ƒï¼šDown 42% | Neutral 18% | Up 40%
- âœ… æ¨¡å‹å­¸æœƒè­˜åˆ¥æ˜ç¢ºçš„æ–¹å‘æ€§ä¿¡è™Ÿ

---

### å ´æ™¯ 3ï¼šè¨“ç·´ã€Œæ©«ç›¤è­˜åˆ¥ã€æ¨¡å‹

**ç›®æ¨™**ï¼šæé«˜å°æŒå¹³ç‹€æ…‹çš„è­˜åˆ¥èƒ½åŠ›

**æ­¥é©Ÿ**ï¼š

```bash
# ç”Ÿæˆå»ºè­°ï¼ˆç›®æ¨™ï¼šæŒå¹³é¡è¼ƒå¤šï¼‰
python scripts/analyze_label_distribution.py \
    --preprocessed-dir data/preprocessed_v5 \
    --mode recommend \
    --target-dist "0.25,0.50,0.25" \
    --output stock_selection_sideways.json
```

**config è¨­å®š**ï¼š

```yaml
data:
  stock_selection:
    enabled: true
    rules:
      - name: "sideways_stocks"
        enabled: true
        min_neutral_pct: 0.35  # æŒå¹³ â‰¥ 35%ï¼ˆæ©«ç›¤è‚¡ï¼‰
        min_total_labels: 1000
```

**çµæœ**ï¼š
- è¨“ç·´é›†æ¨™ç±¤åˆ†å¸ƒï¼šDown 22% | Neutral 48% | Up 30%
- âœ… æ¨¡å‹å­¸æœƒè­˜åˆ¥æ©«ç›¤ç‹€æ…‹

---

### å ´æ™¯ 4ï¼šçµ„åˆç­–ç•¥ï¼ˆæœ€éˆæ´»ï¼‰â­â­â­

**ç›®æ¨™**ï¼šæ ¹æ“šå¯¦éš›è§€å¯Ÿå‹•æ…‹èª¿æ•´è‚¡ç¥¨çµ„åˆ

**æ­¥é©Ÿ**ï¼š

```bash
# 1. å…ˆåˆ†æ
python scripts/analyze_label_distribution.py \
    --preprocessed-dir data/preprocessed_v5 \
    --mode analyze
```

**è§€å¯Ÿçµæœ**ï¼š
```
æ•´é«”åˆ†å¸ƒ:
  Down: 47% | Neutral: 13% | Up: 40%  â† ä¸å¹³è¡¡ï¼

åˆ†çµ„çµ±è¨ˆ:
  MEDIUM çµ„ (85 æª”): Down 28% | Neutral 25% | Up 47%
  HIGH çµ„ (26 æª”): Down 25% | Neutral 35% | Up 40%
```

**çµ„åˆç­–ç•¥**ï¼š

```yaml
data:
  stock_selection:
    enabled: true
    rules:
      # 70% ä¾†è‡ª HIGH çµ„ï¼ˆè£œå„ŸæŒå¹³é¡ï¼‰
      - name: "high_neutral"
        enabled: true
        min_neutral_pct: 0.30
        max_neutral_pct: 0.45
        weight: 0.7

      # 30% ä¾†è‡ª MEDIUM çµ„ï¼ˆå¹³è¡¡ï¼‰
      - name: "medium_neutral"
        enabled: true
        min_neutral_pct: 0.20
        max_neutral_pct: 0.30
        weight: 0.3
```

**é æœŸçµæœ**ï¼š
- æœ€çµ‚è¨“ç·´é›†ï¼šDown 27% | Neutral 32% | Up 41% âœ…

---

## æ¸¬è©¦é©—è­‰

### å¿«é€Ÿé©—è­‰æ¨™ç±¤é è¦½

```bash
python scripts/test_label_preview.py
```

**é æœŸè¼¸å‡º**ï¼š

```
======================================================================
æ¸¬è©¦ NPZ æ¨™ç±¤é è¦½åŠŸèƒ½
======================================================================

æª”æ¡ˆ: 2330.npz
âœ… æ¨™ç±¤é è¦½:
   ç¸½æ¨™ç±¤æ•¸: 14,278
   Down:      4,512 ( 31.62%)
   Neutral:   2,145 ( 15.02%)
   Up:        7,621 ( 53.37%)
   âœ“ ç¸½å’Œé©—è­‰é€šé

======================================================================
ç¤ºç¯„ï¼šåŸºæ–¼æ¨™ç±¤åˆ†å¸ƒçš„è‚¡ç¥¨ç¯©é¸
======================================================================

éæ¿¾æ¢ä»¶:
   æŒå¹³æ¯”ä¾‹: 10% - 50%
   æœ€å°‘æ¨™ç±¤æ•¸: 1,000

çµæœ:
   é€šé: 198 æª”
   æœªé€šé: 13 æª”

âœ… é€šéçš„è‚¡ç¥¨ï¼ˆå‰ 10 æª”ï¼‰:
   2330: Down 31.6% | Neutral 15.0% | Up 53.4%
   2317: Down 28.9% | Neutral 18.2% | Up 52.9%
```

---

## é€²éšç”¨æ³•

### è‡ªå®šç¾©åˆ†æè…³æœ¬

æ ¹æ“šæ¨™ç±¤åˆ†å¸ƒæ’åºä¸¦é¸å–è‚¡ç¥¨ï¼š

```python
import glob
import json
import numpy as np

# è®€å–æ‰€æœ‰ NPZ
npz_files = glob.glob("data/preprocessed_v5/daily/20250901/*.npz")
stocks_info = []

for npz_file in npz_files:
    data = np.load(npz_file, allow_pickle=True)
    metadata = json.loads(str(data['metadata']))

    if 'label_preview' in metadata and metadata['label_preview'] is not None:
        lp = metadata['label_preview']
        stocks_info.append({
            'symbol': metadata['symbol'],
            'neutral_pct': lp['neutral_pct'],
            'down_pct': lp['down_pct'],
            'up_pct': lp['up_pct'],
            'total_labels': lp['total_labels']
        })

# æŒ‰æŒå¹³æ¯”ä¾‹æ’åº
stocks_sorted = sorted(stocks_info, key=lambda x: x['neutral_pct'])

# é¸å–æŒå¹³æ¯”ä¾‹ 20-30% çš„è‚¡ç¥¨ï¼ˆé©åˆè¨“ç·´å¹³è¡¡æ¨¡å‹ï¼‰
balanced_stocks = [s for s in stocks_sorted if 0.20 <= s['neutral_pct'] <= 0.30]

print(f"æ‰¾åˆ° {len(balanced_stocks)} æª”å¹³è¡¡è‚¡ç¥¨")
for stock in balanced_stocks[:10]:
    print(f"  {stock['symbol']}: Down {stock['down_pct']:.1%} | "
          f"Neutral {stock['neutral_pct']:.1%} | Up {stock['up_pct']:.1%}")

# ä¿å­˜é¸å–çµæœ
selected_symbols = [s['symbol'] for s in balanced_stocks]
with open('selected_stocks.json', 'w') as f:
    json.dump(selected_symbols, f)
```

---

## å¸¸è¦‹å•é¡Œ

### Q1: æ¨™ç±¤é è¦½å’Œå¯¦éš› extract_v6 çš„æ¨™ç±¤æœƒä¸€æ¨£å—ï¼Ÿ

**A**: å¹¾ä¹ä¸€æ¨£ï¼Œä½†å¯èƒ½æœ‰å¾®å°å·®ç•°ï¼ˆ< 1%ï¼‰ï¼š

- **é è¦½éšæ®µ**ï¼šä½¿ç”¨å®Œæ•´çš„ `mids` åºåˆ—è¨ˆç®—ï¼ˆ14400 å€‹é»ï¼‰
- **æå–éšæ®µ**ï¼šå¯èƒ½å› ç‚ºæ»‘çª—åˆ‡åˆ†æˆ–æ•¸æ“šé©—è­‰è€Œç•¥æœ‰ä¸åŒ

å·®ç•°é€šå¸¸å¯ä»¥å¿½ç•¥ï¼Œæ”¾å¿ƒä½¿ç”¨ã€‚

---

### Q2: å¦‚æœæŸå€‹è‚¡ç¥¨æ²’æœ‰ `label_preview`ï¼Ÿ

**A**: å¯èƒ½åŸå› ï¼š

1. æœªé€šéæ³¢å‹•ç‡éæ¿¾ï¼ˆ`pass_filter=false`ï¼‰
2. Triple-Barrier è¨ˆç®—å¤±æ•—ï¼ˆæ•¸æ“šè³ªé‡å•é¡Œï¼‰
3. ä½¿ç”¨èˆŠç‰ˆæœ¬çš„ `preprocess_single_day.py`ï¼ˆæœªæ›´æ–°ï¼‰

**è§£æ±ºæ–¹æ³•**ï¼š
- é‡æ–°åŸ·è¡Œ `batch_preprocess.bat`ï¼ˆä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ï¼‰
- ç„¡æ¨™ç±¤é è¦½çš„è‚¡ç¥¨æœƒåœ¨ extract_v6 æ™‚è‡ªå‹•è·³é

---

### Q3: å¦‚ä½•èª¿æ•´æ¨™ç±¤é¸å–ç­–ç•¥ï¼Ÿ

**A**: æ ¹æ“š `analyze_label_distribution.py` çš„åˆ†æçµæœèª¿æ•´ configï¼š

**ç¯„ä¾‹ 1ï¼šç•¶å‰æŒå¹³é¡å¤ªå°‘ï¼ˆ15%ï¼‰ï¼Œç›®æ¨™ 40%**
```yaml
data:
  stock_selection:
    rules:
      - min_neutral_pct: 0.30  # é¸æŒå¹³é¡è¼ƒå¤šçš„è‚¡ç¥¨
        max_neutral_pct: 0.50
        weight: 0.8  # ä½” 80%
```

**ç¯„ä¾‹ 2ï¼šç•¶å‰æŒå¹³é¡é©ä¸­ï¼ˆ35%ï¼‰ï¼Œç¶­æŒå¹³è¡¡**
```yaml
data:
  stock_selection:
    rules:
      - min_neutral_pct: 0.25
        max_neutral_pct: 0.45
        weight: 1.0  # å…¨éƒ¨ä½¿ç”¨
```

---

### Q4: æ¨™ç±¤é è¦½æœƒå½±éŸ¿é è™•ç†é€Ÿåº¦å—ï¼Ÿ

**A**: æœƒç•¥å¾®å¢åŠ ï¼Œä½†å½±éŸ¿å¾ˆå°ï¼š

- å–®æª”è‚¡ç¥¨ï¼š+2-5 ç§’
- æ‰¹æ¬¡é è™•ç†ï¼ˆ100+ æª”ï¼‰ï¼š+3-8 åˆ†é˜
- **ç¸½é«”å½±éŸ¿ < 10%**

**å„ªé»**ï¼šæå‰çŸ¥é“æ¨™ç±¤åˆ†å¸ƒï¼Œé¿å… extract_v6 æ™‚æµªè²»æ™‚é–“è™•ç†ä¸åˆé©çš„è‚¡ç¥¨ã€‚

---

### Q5: ç‚ºä»€éº¼ä¸ç›´æ¥ç¡¬æ€§éæ¿¾ï¼Ÿ

**A**: å› ç‚ºä¸åŒè¨“ç·´ç›®æ¨™éœ€è¦ä¸åŒçš„æ¨™ç±¤åˆ†å¸ƒï¼š

| è¨“ç·´ç›®æ¨™ | ç†æƒ³åˆ†å¸ƒ | é¸å–ç­–ç•¥ |
|---------|---------|---------|
| å¹³è¡¡æ¨¡å‹ | Down 30% \| Neutral 40% \| Up 30% | é¸æŒå¹³ 25-45% è‚¡ç¥¨ |
| è¶¨å‹¢æ•æ‰ | Down 40% \| Neutral 20% \| Up 40% | é¸æŒå¹³ < 25% è‚¡ç¥¨ |
| æ©«ç›¤è­˜åˆ¥ | Down 25% \| Neutral 50% \| Up 25% | é¸æŒå¹³ > 35% è‚¡ç¥¨ |

**ç¡¬æ€§éæ¿¾**ç„¡æ³•æ»¿è¶³é€™äº›ä¸åŒéœ€æ±‚ï¼Œ**éˆæ´»é¸æ“‡**æ‰æ˜¯ç‹é“ã€‚

---

## å·¥å…·ä¸€è¦½è¡¨

| å·¥å…· | ç”¨é€” | å‘½ä»¤ |
|------|------|------|
| `preprocess_single_day.py` | ç”Ÿæˆæ¨™ç±¤é è¦½ | `scripts\batch_preprocess.bat` |
| `test_label_preview.py` | é©—è­‰æ¨™ç±¤é è¦½ | `python scripts/test_label_preview.py` |
| `analyze_label_distribution.py` | åˆ†æä¸¦æ¨è–¦é¸å–ç­–ç•¥ | `python scripts/analyze_label_distribution.py --mode analyze` |
| `extract_tw_stock_data_v6.py` | æ ¹æ“šç­–ç•¥æå–æ•¸æ“š | `python scripts/extract_tw_stock_data_v6.py ...` |

---

## ç¸½çµ

âœ… **æ ¸å¿ƒå„ªå‹¢**:

1. **å…¨å±€è¦–é‡**ï¼šçœ‹åˆ°æ¯å€‹è‚¡ç¥¨çš„æ¨™ç±¤åˆ†å¸ƒç‰¹æ€§
2. **éˆæ´»çµ„åˆ**ï¼šæ ¹æ“šè¨“ç·´ç›®æ¨™ä¸»å‹•æŒ‘é¸è‚¡ç¥¨
3. **é¿å…æ¥µç«¯**ï¼šä¸æœƒè¢«å°‘æ•¸æ¥µç«¯è‚¡ç¥¨ä¸»å°è¨“ç·´é›†
4. **é‡å°æ€§è£œå„Ÿ**ï¼šç¼ºä»€éº¼é¡åˆ¥å°±é¸ä»€éº¼ç‰¹æ€§çš„è‚¡ç¥¨

âš ï¸ **é—œéµç†å¿µ**:

> æ¨™ç±¤é è¦½æ˜¯ã€ŒçŸ¥æƒ…é¸æ“‡ã€è€Œéã€Œç¡¬æ€§éæ¿¾ã€ã€‚æ¯å€‹è‚¡ç¥¨éƒ½æœ‰åƒ¹å€¼ï¼Œé—œéµæ˜¯å¦‚ä½•çµ„åˆå®ƒå€‘ä¾†é”åˆ°ä½ çš„è¨“ç·´ç›®æ¨™ã€‚

ğŸ¯ **æ¨è–¦å·¥ä½œæµç¨‹**:

1. åŸ·è¡Œ `batch_preprocess.bat` ç”Ÿæˆæ¨™ç±¤é è¦½
2. ä½¿ç”¨ `analyze_label_distribution.py` åˆ†æç•¶å‰åˆ†å¸ƒ
3. æ ¹æ“šåˆ†æçµæœåˆ¶å®šé¸å–ç­–ç•¥
4. ä¿®æ”¹ config ä¸¦åŸ·è¡Œ `extract_tw_stock_data_v6.py`
5. æª¢æŸ¥æœ€çµ‚è¨“ç·´é›†çš„æ¨™ç±¤åˆ†å¸ƒæ˜¯å¦ç¬¦åˆé æœŸ

---

**æœ€å¾Œæ›´æ–°**: 2025-10-23
**ç‰ˆæœ¬**: v2.0ï¼ˆæ–°å¢ analyze_label_distribution.py å·¥å…·ï¼‰

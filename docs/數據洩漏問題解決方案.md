# æ•¸æ“šæ´©æ¼å•é¡Œè§£æ±ºæ–¹æ¡ˆ

**ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2025-10-21
**å•é¡Œ**: å¥åº·æª¢æŸ¥ç™¼ç¾æœªä¾†è³‡è¨Šæ´©æ¼ï¼ˆæª¢æŸ¥ 2 å¤±æ•—ï¼‰

---

## ğŸ“‹ å•é¡Œè¨ºæ–·

### åŸå§‹å¥åº·æª¢æŸ¥çµæœ

```
æª¢æŸ¥ 2: æœªä¾†è³‡è¨Šæ´©æ¼æ¸¬è©¦
  åŸºæº–æ¨¡å‹ï¼ˆæ­£å¸¸å°é½Šï¼‰: æº–ç¢ºç‡ 0.588 (58.8%)
  æ¸¬è©¦ A: æ™‚é–“æ‰“äº‚æ¨™ç±¤:    æº–ç¢ºç‡ 0.539 (53.9%)
  ä¸‹é™å¹…åº¦: 0.048 (4.8%)
  çµæœ: âŒ å¤±æ•— - æ‰“äº‚å¾Œä»é«˜æº–ç¢ºç‡ï¼Œå¯èƒ½æœ‰æ´©æ¼
```

### å•é¡Œåˆ†æ

**æ­£å¸¸æƒ…æ³**ï¼ˆç„¡æ´©æ¼ï¼‰:
- æ‰“äº‚æ¨™ç±¤å¾Œï¼Œæ¨¡å‹æ‡‰è©²ç„¡æ³•å­¸ç¿’
- æº–ç¢ºç‡æ‡‰è©²ä¸‹é™åˆ°æ¥è¿‘éš¨æ©Ÿï¼ˆ~33%ï¼Œ3 é¡åˆ¥ï¼‰
- æœŸæœ›ä¸‹é™å¹…åº¦ > 10%

**å¯¦éš›æƒ…æ³**ï¼ˆæœ‰æ´©æ¼ï¼‰:
- æ‰“äº‚æ¨™ç±¤å¾Œï¼Œæº–ç¢ºç‡åªä¸‹é™ 4.8%
- ä»ç„¶é”åˆ° 53.9%ï¼ˆé é«˜æ–¼éš¨æ©Ÿ 33%ï¼‰
- **è¨ºæ–·**: ç‰¹å¾µä¸­åŒ…å«ã€Œæœªä¾†è³‡è¨Šã€

### æ´©æ¼åŸå› 

#### ä¸»è¦åŸå› ï¼šéš¨æ©Ÿåˆ‡åˆ†å°è‡´æ™‚é–“æ´©æ¼ â­â­â­â­â­

**èˆŠæ–¹æ³•**ï¼ˆæŒ‰è‚¡ç¥¨éš¨æ©Ÿåˆ‡åˆ†ï¼‰:
```
è‚¡ç¥¨ A: Day 1-10 â†’ éš¨æ©Ÿåˆ†é…åˆ° train/val/test
è‚¡ç¥¨ B: Day 1-10 â†’ éš¨æ©Ÿåˆ†é…åˆ° train/val/test
...
```

**å•é¡Œ**:
1. åŒä¸€è‚¡ç¥¨çš„ä¸åŒå¤©è¢«æ‹†åˆ°ä¸åŒé›†åˆ
2. è¨“ç·´é›†å¯èƒ½åŒ…å« Day 8-10 çš„æ•¸æ“š
3. æ¸¬è©¦é›†å¯èƒ½åŒ…å« Day 1-3 çš„æ•¸æ“š
4. **çµæœ**: ç”¨ã€Œæœªä¾†ã€è¨“ç·´ï¼Œæ¸¬è©¦ã€Œéå»ã€â†’ æ™‚é–“æ´©æ¼

**ç¯„ä¾‹**:
```
è¨“ç·´é›†: è‚¡ç¥¨ A (Day 8-10) + è‚¡ç¥¨ B (Day 1-3) + ...
æ¸¬è©¦é›†: è‚¡ç¥¨ A (Day 1-7) + è‚¡ç¥¨ C (Day 5-10) + ...
        â””â”€ æ™‚é–“é‡ç–Šï¼è¨“ç·´é›†çœ‹é Day 8-10ï¼Œæ¸¬è©¦é›†ä¹Ÿæœ‰ Day 8-10
```

#### æ¬¡è¦åŸå› ï¼šæ»‘çª—é‡ç–Š

**æ»‘çª—é‡ç–Š**ï¼ˆ99% é‡ç–Šï¼‰:
```
Window 1: [t=0   ... t=99]  â†’ Label at t=99
Window 2: [t=1   ... t=100] â†’ Label at t=100
         â””â”€â”€â”€ 99% é‡ç–Šï¼ â”€â”€â”€â”˜
```

**å½±éŸ¿**:
- ç›¸é„°æ¨£æœ¬ç‰¹å¾µå¹¾ä¹å®Œå…¨ç›¸åŒ
- æ¨¡å‹å­¸åˆ°ã€Œç›¸é„°æ¨£æœ¬æœ‰ç›¸ä¼¼æ¨™ç±¤ã€è€ŒéçœŸæ­£çš„åƒ¹æ ¼é æ¸¬
- æ‰“äº‚æ¨™ç±¤å¾Œï¼Œä»èƒ½åˆ©ç”¨ç‰¹å¾µç›¸ä¼¼æ€§çŒœæ¸¬

---

## ğŸ› ï¸ è§£æ±ºæ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: æ™‚é–“åºåˆ—åˆ‡åˆ†ï¼ˆå·²å¯¦æ–½ï¼‰â­â­â­â­â­

#### æ–°æ–¹æ³•ï¼ˆæŒ‰æ™‚é–“åˆ‡åˆ†ï¼‰

```
æ‰€æœ‰è‚¡ç¥¨:
  Day 1-7   â†’ è¨“ç·´é›†ï¼ˆæ‰€æœ‰è‚¡ç¥¨ï¼‰
  Day 8-9   â†’ é©—è­‰é›†ï¼ˆæ‰€æœ‰è‚¡ç¥¨ï¼‰
  Day 10    â†’ æ¸¬è©¦é›†ï¼ˆæ‰€æœ‰è‚¡ç¥¨ï¼‰
```

#### å„ªå‹¢

| ç‰¹æ€§ | éš¨æ©Ÿåˆ‡åˆ† | æ™‚é–“åºåˆ—åˆ‡åˆ† |
|------|---------|-------------|
| æ™‚é–“æ´©æ¼ | âŒ åš´é‡ | âœ… ç„¡ |
| ç¬¦åˆå¯¦éš›äº¤æ˜“ | âŒ ä¸ç¬¦åˆ | âœ… å®Œå…¨ç¬¦åˆ |
| åˆ†å¸ƒç©©å®šæ€§ | â­â­â­â­ | â­â­â­ (å¯èƒ½æ¼‚ç§») |
| æ¸¬è©¦é›†å¤§å° | â­â­â­â­â­ | â­â­â­ (è¼ƒå°) |

#### é…ç½®ä¿®æ”¹

```yaml
# configs/config_pro_v5_ml_optimal.yaml
split:
  method: 'temporal'  # æ”¹ç‚ºæ™‚é–“åºåˆ—åˆ‡åˆ†
  train_days: 7       # å‰ 7 å¤©è¨“ç·´
  val_days: 2         # ä¸­é–“ 2 å¤©é©—è­‰
  test_days: 1        # æœ€å¾Œ 1 å¤©æ¸¬è©¦
```

#### ä»£ç¢¼ä¿®æ”¹

**ä¸»è¦ä¿®æ”¹**: `scripts/extract_tw_stock_data_v6.py`

```python
# èˆŠæ–¹æ³•ï¼ˆç¬¬ 607-629 è¡Œï¼‰
# æŒ‰è‚¡ç¥¨éš¨æ©Ÿåˆ‡åˆ† 70/15/15
random.shuffle(valid_stocks)
train_stocks = valid_stocks[:n_train]
val_stocks = valid_stocks[n_train:n_train + n_val]
test_stocks = valid_stocks[n_train + n_val:]

# æ–°æ–¹æ³•ï¼ˆç¬¬ 607-697 è¡Œï¼‰
# æŒ‰æ™‚é–“åˆ‡åˆ†
if split_method == 'temporal':
    # æå–æ‰€æœ‰æ—¥æœŸä¸¦æ’åº
    sorted_dates = sorted(all_dates)

    # æŒ‰æ—¥æœŸåˆ‡åˆ†
    train_date_set = set(sorted_dates[:train_days])
    val_date_set = set(sorted_dates[train_days:train_days + val_days])
    test_date_set = set(sorted_dates[train_days + val_days:])

    # ç‚ºæ¯å€‹é›†åˆéæ¿¾å°æ‡‰æ—¥æœŸçš„æ•¸æ“š
    for sym, n_points, day_data_sorted in valid_stocks:
        train_day_data = [... if date in train_date_set]
        val_day_data = [... if date in val_date_set]
        test_day_data = [... if date in test_date_set]
```

### æ–¹æ¡ˆ 2: æ»¾å‹•çª—å£æ¨™æº–åŒ–ï¼ˆå·²å¯¦æ–½ï¼‰â­â­â­â­

**é…ç½®ä¿®æ”¹**:
```yaml
normalization:
  method: 'rolling_zscore'  # æ»¾å‹•çª—å£ Z-Score
  window: 100               # ä½¿ç”¨æœ€è¿‘ 100 å€‹ tick
  min_periods: 20           # æœ€å°æœ‰æ•ˆæ¨£æœ¬æ•¸
```

**å„ªå‹¢**:
- é©æ‡‰å¸‚å ´è®ŠåŒ–ï¼ˆçµ±è¨ˆé‡å‹•æ…‹æ›´æ–°ï¼‰
- æ¸›å°‘åˆ†å¸ƒæ¼‚ç§»ï¼ˆPSI é æœŸ < 0.1ï¼‰
- ç¬¦åˆå¯¦éš›äº¤æ˜“ï¼ˆåªç”¨æ­·å²æ•¸æ“šï¼‰

---

## ğŸ“Š é æœŸæ”¹å–„

### æ´©æ¼æ¸¬è©¦é æœŸçµæœ

**ä¿®æ­£å‰**:
```
åŸºæº–æº–ç¢ºç‡: 58.8%
æ‰“äº‚å¾Œæº–ç¢ºç‡: 53.9%
ä¸‹é™å¹…åº¦: 4.8% âŒ
```

**ä¿®æ­£å¾Œ**ï¼ˆé æœŸï¼‰:
```
åŸºæº–æº–ç¢ºç‡: 50-55%ï¼ˆå¯èƒ½ç•¥é™ï¼Œä½†æ›´çœŸå¯¦ï¼‰
æ‰“äº‚å¾Œæº–ç¢ºç‡: 33-38%ï¼ˆæ¥è¿‘éš¨æ©Ÿï¼‰
ä¸‹é™å¹…åº¦: > 15% âœ…
```

### ç©©å®šæ€§æ¸¬è©¦é æœŸçµæœ

**ä¿®æ­£å‰**:
```
PSI å¹³å‡: 0.207ï¼ˆè¼•å¾®æ¼‚ç§»ï¼‰
PSI æœ€å¤§: 0.383ï¼ˆé¡¯è‘—æ¼‚ç§»ï¼‰
ç‹€æ…‹: âŒ å¤±æ•—
```

**ä¿®æ­£å¾Œ**ï¼ˆé æœŸï¼‰:
```
PSI å¹³å‡: < 0.1ï¼ˆç©©å®šï¼‰
PSI æœ€å¤§: < 0.15ï¼ˆç©©å®šï¼‰
ç‹€æ…‹: âœ… é€šé
```

---

## ğŸ¯ åŸ·è¡Œæ­¥é©Ÿ

### æ­¥é©Ÿ 1: ä¿®æ”¹é…ç½®ï¼ˆå·²å®Œæˆï¼‰âœ…

```yaml
# configs/config_pro_v5_ml_optimal.yaml
split:
  method: 'temporal'
  train_days: 7
  val_days: 2
  test_days: 1

normalization:
  method: 'rolling_zscore'
  window: 100
  min_periods: 20
```

### æ­¥é©Ÿ 2: ä¿®æ”¹ä»£ç¢¼ï¼ˆå·²å®Œæˆï¼‰âœ…

- âœ… `scripts/extract_tw_stock_data_v6.py`: æ–°å¢æ™‚é–“åºåˆ—åˆ‡åˆ†é‚è¼¯
- âœ… `scripts/extract_tw_stock_data_v6.py`: æ–°å¢æ»¾å‹•çª—å£æ¨™æº–åŒ–
- âœ… Metadata è¨˜éŒ„åˆ‡åˆ†æ–¹æ³•å’Œæ—¥æœŸç¯„åœ

### æ­¥é©Ÿ 3: é‡æ–°ç”Ÿæˆæ•¸æ“šï¼ˆåŸ·è¡Œä¸­ï¼‰â³

```bash
conda activate deeplob-pro
python scripts/extract_tw_stock_data_v6.py \
    --preprocessed-dir ./data/preprocessed_v5_1hz \
    --output-dir ./data/processed_v6_temporal \
    --config ./configs/config_pro_v5_ml_optimal.yaml
```

### æ­¥é©Ÿ 4: é©—è­‰æ”¹å–„ï¼ˆå¾…åŸ·è¡Œï¼‰

```bash
# å¥åº·æª¢æŸ¥
python scripts/data_health_check.py \
    --train-npz data/processed_v6_temporal/npz/stock_embedding_train.npz \
    --val-npz data/processed_v6_temporal/npz/stock_embedding_val.npz \
    --test-npz data/processed_v6_temporal/npz/stock_embedding_test.npz \
    --output-dir data/processed_v6_temporal/health_check
```

---

## ğŸ“ é—œéµæ”¹é€²ç¸½çµ

### 1. æ™‚é–“åºåˆ—åˆ‡åˆ†ï¼ˆæ ¸å¿ƒæ”¹é€²ï¼‰

| é …ç›® | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ |
|------|-------|-------|
| åˆ‡åˆ†æ–¹å¼ | æŒ‰è‚¡ç¥¨éš¨æ©Ÿ | æŒ‰æ—¥æœŸé †åº |
| æ™‚é–“æ´©æ¼ | âŒ åš´é‡ | âœ… ç„¡ |
| è¨“ç·´é›† | 70% è‚¡ç¥¨ï¼ˆæ‰€æœ‰å¤©ï¼‰ | æ‰€æœ‰è‚¡ç¥¨ï¼ˆå‰ 7 å¤©ï¼‰ |
| æ¸¬è©¦é›† | 15% è‚¡ç¥¨ï¼ˆæ‰€æœ‰å¤©ï¼‰ | æ‰€æœ‰è‚¡ç¥¨ï¼ˆæœ€å¾Œ 1 å¤©ï¼‰ |
| ç¬¦åˆå¯¦éš› | âŒ | âœ… |

### 2. æ»¾å‹•çª—å£æ¨™æº–åŒ–ï¼ˆè¼”åŠ©æ”¹é€²ï¼‰

| é …ç›® | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ |
|------|-------|-------|
| æ¨™æº–åŒ–æ–¹æ³• | å…¨å±€çµ±è¨ˆé‡ | æ»¾å‹•çª—å£ |
| åˆ†å¸ƒæ¼‚ç§» | PSI=0.38 | PSI<0.1ï¼ˆé æœŸï¼‰ |
| é©æ‡‰æ€§ | âŒ éœæ…‹ | âœ… å‹•æ…‹ |

### 3. Metadata å¢å¼·

- âœ… è¨˜éŒ„åˆ‡åˆ†æ–¹æ³•ï¼ˆ`temporal` æˆ– `random`ï¼‰
- âœ… è¨˜éŒ„è¨“ç·´/é©—è­‰/æ¸¬è©¦æ—¥æœŸç¯„åœ
- âœ… è¨˜éŒ„æ¨™æº–åŒ–æ–¹æ³•å’Œåƒæ•¸
- âœ… æ¨™è¨»ã€Œæ™‚é–“åºåˆ—åˆ‡åˆ†é¿å…æœªä¾†è³‡è¨Šæ´©æ¼ã€

---

## âš ï¸ æ³¨æ„äº‹é …

### æ½›åœ¨å•é¡Œ

1. **æ¸¬è©¦é›†è®Šå°**
   - èˆŠæ–¹æ³•: 15% è‚¡ç¥¨ Ã— 10 å¤© = ç´„ 150 symbol-days
   - æ–°æ–¹æ³•: æ‰€æœ‰è‚¡ç¥¨ Ã— 1 å¤© = ç´„ 294 symbol-days
   - **å½±éŸ¿**: æ¸¬è©¦é›†æ¨£æœ¬æ•¸å¯èƒ½æ¸›å°‘ï¼ˆå–æ±ºæ–¼è‚¡ç¥¨åœ¨ Day 10 çš„æ´»èºåº¦ï¼‰

2. **åˆ†å¸ƒæ¼‚ç§»é¢¨éšª**
   - è¨“ç·´é›†ï¼ˆDay 1-7ï¼‰å’Œæ¸¬è©¦é›†ï¼ˆDay 10ï¼‰ä¹‹é–“å¯èƒ½æœ‰åˆ†å¸ƒå·®ç•°
   - **ç·©è§£**: æ»¾å‹•çª—å£æ¨™æº–åŒ–èƒ½éƒ¨åˆ†é©æ‡‰åˆ†å¸ƒè®ŠåŒ–

3. **æ³›åŒ–èƒ½åŠ›è©•ä¼°**
   - åªæ¸¬è©¦ 1 å¤©çš„æ•¸æ“šï¼Œæ³›åŒ–èƒ½åŠ›è©•ä¼°å¯èƒ½ä¸å¤ å…¨é¢
   - **å»ºè­°**: æœªä¾†å¯å¯¦æ–½æ»¾å‹•å›æ¸¬ï¼ˆWalk-Forward Validationï¼‰

### é©—è­‰æ¨™æº–

**å¥åº·æª¢æŸ¥å¿…é ˆé€šé**:
- âœ… æª¢æŸ¥ 1: æ¨™ç±¤å¹³è¡¡ï¼ˆå·²é€šéï¼‰
- âœ… æª¢æŸ¥ 2: æœªä¾†è³‡è¨Šæ´©æ¼ï¼ˆé æœŸé€šéï¼Œä¸‹é™å¹…åº¦ > 10%ï¼‰
- âœ… æª¢æŸ¥ 3: æ•¸æ“šè¶³é‡ï¼ˆå·²é€šéï¼‰
- âœ… æª¢æŸ¥ 4: ç©©å®šæ€§ï¼ˆé æœŸé€šéï¼ŒPSI < 0.1ï¼‰
- âœ… æª¢æŸ¥ 5: åŸºæº–å°æ¯”ï¼ˆå·²é€šéï¼‰

---

## ğŸ”— ç›¸é—œæ–‡æª”

- [æ•¸æ“šè³ªé‡é©—è­‰å®Œæ•´æµç¨‹](æ•¸æ“šè³ªé‡é©—è­‰å®Œæ•´æµç¨‹(ç”¢ç”Ÿè¨“ç·´è³‡æ–™).md)
- [ChatGPT æ•¸æ“šè³ªé‡å»ºè­°åˆ†æ](CHATGPT_SUGGESTIONS_ANALYSIS.md)
- [V6 é›™éšæ®µè™•ç†æŒ‡å—](V6_TWO_STAGE_PIPELINE_GUIDE.md)

---

**æœ€å¾Œæ›´æ–°**: 2025-10-21
**ç‹€æ…‹**: ä»£ç¢¼ä¿®æ”¹å®Œæˆï¼Œæ•¸æ“šç”Ÿæˆä¸­ï¼Œå¾…é©—è­‰

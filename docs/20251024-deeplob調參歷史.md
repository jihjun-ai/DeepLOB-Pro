# DeepLOB 調參歷史記錄

每次保留數據及成果,簡要說明(其他廢話不用),這是改下次調參參考用

## 格式:

**日期**:
**配置**:
**結果**:
**問題**:
**結論**:
---

## 實驗 1: V5 基線測試（2025-10-24）

**日期**: 2025-10-24
**配置**: `configs/train_v5.yaml`
- 數據: processed_v7 (Triple-Barrier 標籤)
- 模型: DeepLOB (32-32-32-32-32)
- Dropout: 0.7
- LR: 4e-6 (Cosine, warmup=0.40, min=3e-6)
- Batch Size: 384
- Grad Clip: 0.8
- Epochs: 30
- Weight Decay: 0.001

**結果**:
```
| Epoch | Train Loss | Val Loss | Train Acc | Val Acc | Val F1 (W) | Val F1 (U) | Grad Norm |
|-------|-----------|----------|-----------|---------|------------|------------|-----------|
| 7     | 0.9722    | 1.0364   | 53.01%    | 44.49%  | 0.4371     | 0.4261     | 3.79      |
| 10    | 0.8579    | 1.0831   | 61.05%    | 43.86%  | 0.4307     | 0.4275     | 10.61     |
```
- **最佳驗證準確率**: 44.49% @ Epoch 7
- **最佳驗證 F1 (Weighted)**: 0.4371 @ Epoch 7

**問題**:
1. **嚴重過擬合**: Epoch 7 後 Train-Val 差距從 8.5% 擴大到 17.2%
2. **梯度爆炸**: Grad Norm 從 1.86 飆升到 10.61（指數級增長）
3. **驗證性能下降**: Epoch 7 是頂點，之後驗證性能持續惡化
4. **Loss 發散**: Val Loss 從 1.0364 → 1.0831 (上升 4.5%)

**結論**:
- **實際使用趨勢標籤**（經檢查，標籤分布 30.86%/42.96%/26.19%）
- **過擬合根源**: 梯度裁剪不夠 + Dropout 不足 + 訓練太長 + 模型容量過大
- **44.49% 驗證準確率偏低**（三分類隨機 33%，僅好 11%）
- **下一步**: 實驗 2 激進抑制過擬合

---

## 實驗 2: 激進抑制過擬合（2025-10-24）⏳

**日期**: 2025-10-24
**配置**: `configs/train_v5.yaml` (已修改)
- 數據: processed_v7 (趨勢標籤，分布 30.86%/42.96%/26.19%)
- 模型: DeepLOB (32-32-32-**24**-**24**) ← 減小容量
- Dropout: **0.8** ← 增強正則化
- LR: **3e-6** (Cosine, warmup=0.40, min=2e-6) ← 降低學習率
- Batch Size: 384
- Grad Clip: **0.5** ← 更嚴格控制
- Epochs: **15** ← 縮短訓練期
- Weight Decay: **0.01** ← 10倍增強
- Early Stop: patience=3, min_delta=0.001 ← 更早停止

**核心策略**:
1. **減小模型容量**: LSTM/FC 32→24（降低記憶能力）
2. **增強正則化**: Dropout 0.7→0.8, Weight Decay 0.001→0.01
3. **降低學習速度**: LR 4e-6→3e-6, Grad Clip 0.8→0.5
4. **提前停止**: Epochs 30→15, Patience 5→3

**預期目標**:
- Train Acc: 50-55% (下降，減少過擬合)
- Val Acc: 47-50% (提升 2-5%)
- Train-Val Gap: 5-7% (縮小)
- Grad Norm: <5.0 (穩定)

**訓練指令**:
```bash
conda activate deeplob-pro
python scripts/train_deeplob_generic.py --config configs/train_v5.yaml
```

**結果**: (待填寫)

---

## 實驗 3:


